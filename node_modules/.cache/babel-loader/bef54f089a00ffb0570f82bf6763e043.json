{"ast":null,"code":"var _jsxFileName = \"/Users/bentait/Desktop/memriio/memriio_web/src/components/memorymodal/newmemorymodal.js\";\nimport React from 'react';\nimport greycross from '../images/x-grey.png';\nimport tick from '../images/tick.png';\nimport tag from '../images/tag.png';\nimport globe from '../images/outline-globe.png';\nimport calendar from '../images/calendar.png';\nimport key from '../images/key.png';\nimport author from '../images/author.png';\nimport x from '../images/x-symbol.png';\nimport edit from '../images/edit.png';\nimport left from '../images/chevron-left.png';\nimport right from '../images/chevron-right.png';\nimport trash from '../images/trash.png';\nimport hero from '../images/hero-full.png';\nimport heroOutline from '../images/hero-outline-grey.png';\nimport cloudIMG from '../images/cloud.png';\nimport MemoryFileViewer from '../memoryviewer/memoryImageViewer';\nimport * as mem from '../memriioserver';\nimport * as DropSearch from '../dropsearch/dropsearch';\nimport WordExctractor from 'keyword-extractor';\nimport { Container, Draggable } from 'react-smooth-dnd';\nimport Dropzone, { useDropzone } from 'react-dropzone';\nimport './memorymodal.css';\nimport { CheckBox, ImageLabel } from '../buttons/buttons';\n\nclass NewMemoryModal extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      memid: 0,\n      createdon: '',\n      userid: 0,\n      title: '',\n      description: '',\n      location: '',\n      story: '',\n      cardtype: 0,\n      taggedPeople: [],\n      memoryClouds: [],\n      searchWords: [],\n      memfiles: [],\n      memfileImages: [],\n      cloudPeople: [],\n      activefile: null,\n      userClouds: [],\n      memfileIndex: 0\n    };\n\n    this.onHide = () => {\n      alert('implement file upload');\n      this.props.onHideModal(this.props.memory);\n    };\n\n    this.thisNeverGetsCalled = () => {\n      this.populateMemoryFiles(this.props.memfiles);\n      mem.getUser(this.props.memory.userid, author => {\n        this.setState({\n          author: author\n        });\n      });\n      mem.getTaggedPeople(this.props.memory.memid, people => {\n        this.setState({\n          taggedPeople: people\n        });\n      });\n      mem.getMemoryClouds(this.props.memory.memid, clouds => {\n        this.populateCloudInfo(clouds);\n      });\n      mem.getMemorySearchWords(this.props.memory.memid, words => {\n        this.populateSearchWords(words);\n      });\n      mem.getUserClouds(this.props.memory.userid, clouds => {\n        this.setState({\n          userClouds: clouds\n        });\n      }); //mem.addTaggedPerson(this.props.memory.memid,Person.userid)\n      //mem.deleteTaggedCloud(this.props.memory.memid,Cloud.id)\n      //mem.deleteTaggedPerson(this.props.memory.memid,Person.userid)\n      // mem.addTaggedCloud(this.props.memory.memid,newCloudID)\n      //mem.updateMemword(this.state.searchWords[ind])\n      //mem.updateStory(this.props.memory.memid,newStory)    \n      //mem.setMemorySearchWords(this.props.memory.memid,this.state.searchWords)\n      //mem.updateDescription(this.props.memory.memid,newDescription)\n      //mem.updateTitle(this.props.memory.memid,newTitle)\n      //this.prepAndUploadFile(file)\n    };\n\n    this.getHeroFile = () => {\n      let hero = this.state.memfiles[0];\n      this.state.memfiles.map((memfile, index) => {\n        if (memfile.ishero) {\n          this.state.memfileIndex = index;\n          hero = memfile;\n        }\n      });\n      return hero;\n    };\n\n    this.populateMemoryFiles = memfiles => {\n      this.state.memfiles = memfiles;\n      this.setState({\n        activefile: this.getHeroFile()\n      });\n    };\n\n    this.populateSearchWords = words => {\n      this.setState({\n        searchWords: words\n      });\n    };\n\n    this.populateCloudInfo = clouds => {\n      this.setState({\n        memoryClouds: clouds\n      });\n      mem.getCloudPeople(clouds, people => {\n        this.setState({\n          cloudPeople: people\n        });\n      });\n    };\n\n    this.userIsAuthorisedToEdit = () => {\n      return true;\n    };\n\n    this.deleteFileFromMemory = () => {\n      console.log('delte file from memroy');\n    };\n\n    this.makeHeroFile = () => {\n      console.log('make hero file');\n    };\n\n    this.handleAddTaggedPerson = Person => {\n      let tp = this.state.taggedPeople;\n\n      if (!tp.find(dude => dude.userid === Person.userid)) {\n        tp.push(Person);\n        tp.reverse();\n        this.setState({\n          taggedPeople: tp\n        });\n      }\n    };\n\n    this.handleRemoveFromCloud = Cloud => {\n      let cl = [];\n      this.state.memoryClouds.map(cloud => {\n        if (cloud.id !== Cloud.id) cl.push(cloud);\n      });\n      this.populateCloudInfo(cl);\n    };\n\n    this.handleDeleteTaggedPerson = Person => {\n      let tp = [];\n      this.state.taggedPeople.map(p => {\n        if (p.userid !== Person.userid) tp.push(p);\n      });\n      this.setState({\n        taggedPeople: tp\n      });\n    };\n\n    this.handleAddCloud = clouds => {\n      let cloud = clouds[0];\n      let cl = this.state.memoryClouds;\n      let newCloudID = parseInt(cloud.value);\n\n      if (!cl.find(newcl => newcl.id === newCloudID)) {\n        cl.push({\n          id: newCloudID,\n          name: cloud.label\n        });\n        cl.reverse();\n        this.setState({\n          memoryClouds: cl\n        });\n        this.populateCloudInfo(cl);\n      }\n    };\n\n    this.activeFileisHero = () => {\n      var afile = this.state.activefile;\n\n      if (afile) {\n        if (afile.ishero) {\n          return true;\n        } else {\n          return false;\n        }\n      } else {\n        return false;\n      }\n    };\n\n    this.render = () => {\n      if (this.props.show) {\n        let memoryContent = this.renderMemoryContent();\n        let carouselControls = this.renderCarouselControls();\n        return /*#__PURE__*/React.createElement(\"div\", {\n          className: \"backdropStyle\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 221,\n            columnNumber: 7\n          }\n        }, /*#__PURE__*/React.createElement(\"div\", {\n          className: \"modalStyle\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 222,\n            columnNumber: 9\n          }\n        }, memoryContent, carouselControls));\n      } else {\n        return null;\n      }\n    };\n\n    this.renderMemoryContent = () => {\n      const imageZone = this.renderImageZone();\n      const storyZone = this.renderStoryZone();\n      const detailsZone = this.renderDetailsZone();\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"modalrow\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 243,\n          columnNumber: 7\n        }\n      }, imageZone, storyZone, detailsZone);\n    };\n\n    this.handleSearchWordClick = (itemKey, upState) => {\n      const ind = this.state.searchWords.findIndex(item => {\n        return item.id === itemKey;\n      });\n      this.state.searchWords[ind].included = upState;\n      this.setState({\n        searchWords: this.state.searchWords\n      });\n    };\n\n    this.renderKeyWords = () => {\n      return /*#__PURE__*/React.createElement(Container, {\n        onDrop: e => this.setState({\n          searchWords: this.applyDrag(this.state.searchWords, e)\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 267,\n          columnNumber: 5\n        }\n      }, this.state.searchWords.map((wordItem, idx) => {\n        return /*#__PURE__*/React.createElement(Draggable, {\n          className: \"wordListItem\",\n          key: 'k' + idx,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 272,\n            columnNumber: 13\n          }\n        }, /*#__PURE__*/React.createElement(CheckBox, {\n          itemKey: wordItem.id,\n          onClick: this.handleSearchWordClick,\n          upState: wordItem.included,\n          downImg: greycross,\n          upImg: tick,\n          label: wordItem.keyword,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 273,\n            columnNumber: 15\n          }\n        }));\n      }));\n    };\n\n    this.applyDrag = (arr, dragResult) => {\n      const {\n        removedIndex,\n        addedIndex,\n        payload\n      } = dragResult;\n      if (removedIndex === null && addedIndex === null) return arr;\n      const result = [...arr];\n      let itemToAdd = payload;\n      if (removedIndex !== null) itemToAdd = result.splice(removedIndex, 1)[0];\n      if (addedIndex !== null) result.splice(addedIndex, 0, itemToAdd);\n      return result;\n    };\n\n    this.renderTaggedPeople = () => {\n      const people = this.state.taggedPeople.map(p => {\n        return /*#__PURE__*/React.createElement(\"li\", {\n          className: \"wordListItem\",\n          key: 'p' + p.userid,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 309,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(ImageLabel, {\n          data: p,\n          leftImg: tag,\n          badge: x,\n          onBadgeClick: this.handleDeleteTaggedPerson,\n          label: p.firstname + ' ' + p.lastname,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 312,\n            columnNumber: 15\n          }\n        }));\n      });\n\n      if (this.state.author) {\n        people.push( /*#__PURE__*/React.createElement(\"li\", {\n          className: \"wordListItem\",\n          key: 'a' + this.state.author.userid,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 323,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(ImageLabel, {\n          leftImg: author,\n          label: this.state.author.firstname + ' ' + this.state.author.lastname,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 326,\n            columnNumber: 13\n          }\n        })));\n      }\n\n      people.reverse();\n      people.push( /*#__PURE__*/React.createElement(\"li\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 333,\n          columnNumber: 20\n        }\n      }, \" \", DropSearch.peopleDropSearch(this.state.cloudPeople, this.handleAddTaggedPerson), \" \"));\n      return people;\n    };\n\n    this.renderDetails = () => {\n      if (this.props.memory) {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 345,\n            columnNumber: 7\n          }\n        }, /*#__PURE__*/React.createElement(\"li\", {\n          className: \"wordListItem\",\n          key: 'location',\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 346,\n            columnNumber: 9\n          }\n        }, /*#__PURE__*/React.createElement(ImageLabel, {\n          leftImg: globe,\n          label: this.props.memory.location,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 348,\n            columnNumber: 28\n          }\n        })), /*#__PURE__*/React.createElement(\"li\", {\n          className: \"wordListItem\",\n          key: 'sss',\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 350,\n            columnNumber: 9\n          }\n        }, /*#__PURE__*/React.createElement(ImageLabel, {\n          leftImg: calendar,\n          label: mem.getShortDate(this.props.memory.createdon),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 352,\n            columnNumber: 23\n          }\n        })));\n      }\n    };\n\n    this.renderClouds = () => {\n      const clouds = this.state.memoryClouds.map(cloud => {\n        return /*#__PURE__*/React.createElement(\"li\", {\n          className: \"wordListItem\",\n          key: 'cloud' + cloud.id,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 367,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(ImageLabel, {\n          data: cloud,\n          badge: x,\n          onBadgeClick: this.handleRemoveFromCloud,\n          leftImg: cloudIMG,\n          label: cloud.name,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 369,\n            columnNumber: 38\n          }\n        }));\n      });\n      clouds.push( /*#__PURE__*/React.createElement(\"li\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 379,\n          columnNumber: 20\n        }\n      }, \" \", DropSearch.cloudDropSearch(this.state.userClouds, null, true, true, this.handleAddCloud, this.state.userid), \" \"));\n      return clouds;\n    };\n\n    this.renderImageZone = () => {\n      let editControls = null;\n      var heroImg = this.activeFileisHero() ? hero : heroOutline;\n      editControls = /*#__PURE__*/React.createElement(\"div\", {\n        className: \"imageEditConrols\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 393,\n          columnNumber: 3\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        className: \"closeBtn\",\n        src: trash,\n        onClick: this.deleteFileFromMemory,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 394,\n          columnNumber: 5\n        }\n      }), /*#__PURE__*/React.createElement(\"img\", {\n        className: \"closeBtn\",\n        src: heroImg,\n        onClick: this.makeHeroFile,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 399,\n          columnNumber: 5\n        }\n      }));\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"imgcolumn\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 407,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(MemoryFileViewer, {\n        memfile: this.state.activefile,\n        thumbStyleClass: 'memoryModalImage',\n        fileStyleClass: 'memoryModalImage',\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 408,\n          columnNumber: 7\n        }\n      }), editControls);\n    };\n\n    this.onTitleBlur = e => {\n      const newTitle = e.target.value;\n      if (newTitle !== this.state.title) this.state.title = newTitle;\n    };\n\n    this.onDescriptionBlur = e => {\n      const newDescription = e.target.value;\n      if (newDescription !== this.state.description) this.state.description = newDescription;\n    };\n\n    this.onStoryBlur = e => {\n      const newStory = e.target.value;\n      if (newStory !== this.state.story) this.state.story = newStory;\n    };\n\n    this.handleStoryChange = event => {\n      let addarray = this.state.searchWords;\n      let addarray2 = [];\n      let story = event.target.value;\n      let words = WordExctractor.extract(story, {\n        language: \"english\",\n        remove_digits: true,\n        return_changed_case: true,\n        remove_duplicates: true\n      }); // add any new words that exist in the story\n\n      words.map(word => {\n        if (!this.searchWordExists(word)) {\n          addarray.push({\n            included: true,\n            keyword: word,\n            strength: 0\n          });\n        }\n      }); // remove any search words that now longer exist in the story\n\n      addarray.map(w => {\n        if (words.find(word => w.keyword === word) !== undefined) {\n          addarray2.push({\n            included: w.included,\n            keyword: w.keyword,\n            strength: w.strength\n          });\n        }\n      });\n      this.setState({\n        searchWords: addarray2,\n        story: story\n      });\n    };\n\n    this.searchWordExists = word => {\n      return this.state.searchWords.find(wordItem => word === wordItem.keyword);\n    };\n\n    this.renderStoryZone = () => {\n      const mem = this.state;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"infoColumn\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 479,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        onBlur: this.onTitleBlur,\n        className: \"input-reset titleEdit\",\n        type: \"text\",\n        defaultValue: mem.title,\n        placeholder: \"Title\",\n        id: \"title\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 480,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(\"input\", {\n        onBlur: this.onDescriptionBlur,\n        className: \"input-reset descriptionEdit\",\n        type: \"text\",\n        defaultValue: mem.description,\n        placeholder: \"Description\",\n        id: \"description\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 483,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(\"textarea\", {\n        onBlur: this.onStoryBlur,\n        className: \"input-reset storyEdit\",\n        onChange: this.handleStoryChange,\n        type: \"text\",\n        defaultValue: mem.story,\n        placeholder: \"Description\",\n        id: \"description\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 486,\n          columnNumber: 9\n        }\n      }));\n    };\n\n    this.renderCornerControls = () => {\n      let editBtn = null;\n\n      if (this.userIsAuthorisedToEdit()) {\n        editBtn = /*#__PURE__*/React.createElement(\"img\", {\n          className: \"closeBtn\",\n          src: edit,\n          onClick: this.toggleEditMode,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 500,\n            columnNumber: 7\n          }\n        });\n      }\n\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"footer\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 506,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        className: \"closeBtn\",\n        src: x,\n        onClick: this.onHide,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 507,\n          columnNumber: 7\n        }\n      }), editBtn);\n    };\n\n    this.renderDetailsZone = () => {\n      const keywords = this.renderKeyWords();\n      const people = this.renderTaggedPeople();\n      const details = this.renderDetails();\n      const clouds = this.renderClouds();\n      const cornerCtrls = this.renderCornerControls();\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"detailsColumn\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 531,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"z40\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 532,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 533,\n          columnNumber: 9\n        }\n      }, \"Tags \"), /*#__PURE__*/React.createElement(\"ul\", {\n        className: \"keyWordList scroll\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 534,\n          columnNumber: 9\n        }\n      }, \"  \", keywords, \" \")), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"z25\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 536,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 537,\n          columnNumber: 9\n        }\n      }, \"People\"), /*#__PURE__*/React.createElement(\"ul\", {\n        className: \"peopleList scroll\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 538,\n          columnNumber: 9\n        }\n      }, \"   \", people, \" \")), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"z15\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 540,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 541,\n          columnNumber: 9\n        }\n      }, \"Clouds\"), /*#__PURE__*/React.createElement(\"ul\", {\n        className: \"cloudList scroll\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 542,\n          columnNumber: 9\n        }\n      }, \"    \", clouds, \" \")), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"z15\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 544,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 545,\n          columnNumber: 9\n        }\n      }, \"Details\"), /*#__PURE__*/React.createElement(\"ul\", {\n        className: \"detailsList \",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 546,\n          columnNumber: 9\n        }\n      }, \"        \", details, \" \")), cornerCtrls);\n    };\n\n    this.handleDropfiles = async acceptedFiles => {\n      const reader = new FileReader();\n      acceptedFiles.forEach(file => {\n        reader.onload = () => {\n          console.log('onload ' + file.name);\n\n          if (mem.canHandleDroppedFile(file.name)) {\n            console.log('can handle dropped file ' + file.name);\n            let mfs = this.state.memfiles;\n            mfs.push(file);\n            let mfis = this.state.memfileImages;\n            mfis.push(reader.result);\n            this.setState({\n              memfiles: mfs,\n              memfileImages: mfis\n            });\n          } else {\n            alert('File type ' + mem.getExtension(file.name) + ' not yet implemented');\n          }\n        };\n\n        reader.readAsArrayBuffer(file);\n      });\n    };\n\n    this.prepAndUploadFile = file => {\n      let commonfileName = this.state.author.userid + '-' + Date.now();\n      let ext = mem.getExtension(file.name);\n      let fname = commonfileName + '-original' + '.' + ext;\n      let tname = commonfileName + '-thumb' + '.' + ext;\n      let filebuffer = null;\n      let newMemfiles = this.state.memfiles;\n      let memfile = {\n        id: 0,\n        memid: this.props.memory.memid,\n        fileurl: '',\n        ishero: false,\n        fileext: ext,\n        thumburl: '',\n        thumbext: ext\n      };\n      mem.compressImage(file, 0.9).then(result => {\n        if (result.success) {\n          filebuffer = result.data;\n          mem.resizeImage(filebuffer, 1500).then(result => {\n            if (result.success) {\n              mem.uploadFile(tname, result.data).then(result => {\n                if (result.success) {\n                  memfile.thumburl = result.awsurl;\n                  newMemfiles.push(memfile);\n                  this.setState({\n                    memfiles: newMemfiles\n                  });\n                  mem.uploadFile(fname, filebuffer).then(result => {\n                    if (result.success) {\n                      let last = this.state.memfiles.length - 1;\n                      this.state.memfiles[last].fileurl = result.awsurl;\n                      mem.addFileToMemory({\n                        originalURL: this.state.memfiles[last].fileurl,\n                        thumbURL: this.state.memfiles[last].thumburl\n                      }, false, this.props.memory.memid).then(result => {\n                        if (result.success) {\n                          console.log('file upload success ! : new memory id :' + JSON.stringify(result));\n                        }\n                      });\n                    }\n                  });\n                }\n              });\n            }\n          });\n        }\n      });\n    };\n\n    this.renderCarouselControls = () => {\n      const mem = this.state;\n      const mfiles = mem.memfileImages;\n      let thumbs = mfiles.map((mfile, index) => {\n        return /*#__PURE__*/React.createElement(\"img\", {\n          key: 'thumb' + index,\n          className: \"thumb\",\n          src: mfile,\n          onClick: index => {},\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 649,\n            columnNumber: 14\n          }\n        });\n      });\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"controlbox\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 652,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        className: \"closeBtn\",\n        src: left,\n        onClick: this.goBack,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 653,\n          columnNumber: 7\n        }\n      }), /*#__PURE__*/React.createElement(Dropzone, {\n        onDrop: acceptedFiles => this.handleDropfiles(acceptedFiles),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 654,\n          columnNumber: 7\n        }\n      }, ({\n        getRootProps,\n        getInputProps\n      }) => /*#__PURE__*/React.createElement(\"div\", Object.assign({\n        className: \"thumbArrayEdit\"\n      }, getRootProps(), {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 657,\n          columnNumber: 13\n        }\n      }), thumbs)), /*#__PURE__*/React.createElement(\"img\", {\n        className: \"closeBtn\",\n        src: right,\n        onClick: this.goForward,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 663,\n          columnNumber: 7\n        }\n      }));\n    };\n\n    this.goBack = e => {\n      let ubound = this.state.memfiles.length - 1;\n\n      if (this.state.memfileIndex === 0) {\n        this.state.memfileIndex = ubound;\n      } else {\n        this.state.memfileIndex--;\n      }\n\n      this.setState({\n        activefile: this.state.memfiles[this.state.memfileIndex]\n      });\n    };\n\n    this.goForward = e => {\n      let ubound = this.state.memfiles.length - 1;\n\n      if (this.state.memfileIndex === ubound) {\n        this.state.memfileIndex = 0;\n      } else {\n        this.state.memfileIndex++;\n      }\n\n      this.setState({\n        activefile: this.state.memfiles[this.state.memfileIndex]\n      });\n    };\n  }\n\n}\n\n;\nexport default NewMemoryModal;","map":{"version":3,"sources":["/Users/bentait/Desktop/memriio/memriio_web/src/components/memorymodal/newmemorymodal.js"],"names":["React","greycross","tick","tag","globe","calendar","key","author","x","edit","left","right","trash","hero","heroOutline","cloudIMG","MemoryFileViewer","mem","DropSearch","WordExctractor","Container","Draggable","Dropzone","useDropzone","CheckBox","ImageLabel","NewMemoryModal","Component","state","memid","createdon","userid","title","description","location","story","cardtype","taggedPeople","memoryClouds","searchWords","memfiles","memfileImages","cloudPeople","activefile","userClouds","memfileIndex","onHide","alert","props","onHideModal","memory","thisNeverGetsCalled","populateMemoryFiles","getUser","setState","getTaggedPeople","people","getMemoryClouds","clouds","populateCloudInfo","getMemorySearchWords","words","populateSearchWords","getUserClouds","getHeroFile","map","memfile","index","ishero","getCloudPeople","userIsAuthorisedToEdit","deleteFileFromMemory","console","log","makeHeroFile","handleAddTaggedPerson","Person","tp","find","dude","push","reverse","handleRemoveFromCloud","Cloud","cl","cloud","id","handleDeleteTaggedPerson","p","handleAddCloud","newCloudID","parseInt","value","newcl","name","label","activeFileisHero","afile","render","show","memoryContent","renderMemoryContent","carouselControls","renderCarouselControls","imageZone","renderImageZone","storyZone","renderStoryZone","detailsZone","renderDetailsZone","handleSearchWordClick","itemKey","upState","ind","findIndex","item","included","renderKeyWords","e","applyDrag","wordItem","idx","keyword","arr","dragResult","removedIndex","addedIndex","payload","result","itemToAdd","splice","renderTaggedPeople","firstname","lastname","peopleDropSearch","renderDetails","getShortDate","renderClouds","cloudDropSearch","editControls","heroImg","onTitleBlur","newTitle","target","onDescriptionBlur","newDescription","onStoryBlur","newStory","handleStoryChange","event","addarray","addarray2","extract","language","remove_digits","return_changed_case","remove_duplicates","word","searchWordExists","strength","w","undefined","renderCornerControls","editBtn","toggleEditMode","keywords","details","cornerCtrls","handleDropfiles","acceptedFiles","reader","FileReader","forEach","file","onload","canHandleDroppedFile","mfs","mfis","getExtension","readAsArrayBuffer","prepAndUploadFile","commonfileName","Date","now","ext","fname","tname","filebuffer","newMemfiles","fileurl","fileext","thumburl","thumbext","compressImage","then","success","data","resizeImage","uploadFile","awsurl","last","length","addFileToMemory","originalURL","thumbURL","JSON","stringify","mfiles","thumbs","mfile","goBack","getRootProps","getInputProps","goForward","ubound"],"mappings":"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","sourcesContent":["import React from 'react';\nimport greycross from '../images/x-grey.png'\nimport tick from '../images/tick.png'\nimport tag from '../images/tag.png'\nimport globe from '../images/outline-globe.png'\nimport calendar from '../images/calendar.png'\nimport key from '../images/key.png'\nimport author from '../images/author.png'\nimport x from '../images/x-symbol.png'\nimport edit from '../images/edit.png'\nimport left from '../images/chevron-left.png'\nimport right from '../images/chevron-right.png'\nimport trash from '../images/trash.png'\nimport hero from '../images/hero-full.png'\nimport heroOutline from '../images/hero-outline-grey.png'\nimport cloudIMG from '../images/cloud.png'\nimport MemoryFileViewer from '../memoryviewer/memoryImageViewer'\nimport * as mem from '../memriioserver'\nimport * as DropSearch from '../dropsearch/dropsearch'\n\nimport WordExctractor from 'keyword-extractor'\nimport { Container, Draggable} from 'react-smooth-dnd'\nimport Dropzone,{useDropzone} from 'react-dropzone'\n\nimport './memorymodal.css'\n\nimport {CheckBox,ImageLabel} from '../buttons/buttons'\n\nclass NewMemoryModal extends React.Component{\n\n    state ={\n       \n          memid:0,\n          createdon:'',\n          userid:0,\n          title:'',\n          description:'',\n          location:'',\n          story:'',\n          cardtype:0,\n          taggedPeople:[],\n          memoryClouds:[],\n          searchWords:[],         \n          memfiles:[],\n          memfileImages:[],\n          cloudPeople:[],\n     \n        activefile:null,\n        userClouds:[],\n        memfileIndex:0,\n    }\n   \n\nonHide = () =>{    \n  alert('implement file upload')\n  this.props.onHideModal(this.props.memory)\n}\n//---------------------------------------------------------------------------------\n// DELETE DELETE DELETE DELETE -----------\n// DELETE DELETE DELETE DELETE -----------\n// DELETE DELETE DELETE DELETE -----------\n\nthisNeverGetsCalled =() =>{\n  \n    \n        this.populateMemoryFiles(this.props.memfiles)\n        mem.getUser              (this.props.memory.userid,(author => { this.setState({author:author})}))\n        mem.getTaggedPeople      ( this.props.memory.memid,(people => { this.setState({taggedPeople:people})}))\n        mem.getMemoryClouds      ( this.props.memory.memid,(clouds => { this.populateCloudInfo(clouds)}))\n        mem.getMemorySearchWords ( this.props.memory.memid,(words  => { this.populateSearchWords(words)}))\n        mem.getUserClouds        ( this.props.memory.userid,(clouds => { this.setState({userClouds:clouds})}))\n\n        //mem.addTaggedPerson(this.props.memory.memid,Person.userid)\n        //mem.deleteTaggedCloud(this.props.memory.memid,Cloud.id)\n        //mem.deleteTaggedPerson(this.props.memory.memid,Person.userid)\n        // mem.addTaggedCloud(this.props.memory.memid,newCloudID)\n        //mem.updateMemword(this.state.searchWords[ind])\n        //mem.updateStory(this.props.memory.memid,newStory)    \n    //mem.setMemorySearchWords(this.props.memory.memid,this.state.searchWords)\n    //mem.updateDescription(this.props.memory.memid,newDescription)\n    //mem.updateTitle(this.props.memory.memid,newTitle)\n    //this.prepAndUploadFile(file)\n        \n     \n}\n\n//---------------------------------------------------------------------------------\n\n\n  getHeroFile = () => {\n    \n    let hero = this.state.memfiles[0]\n\n    this.state.memfiles.map((memfile,index)=> {\n\n        if(memfile.ishero){         \n            this.state.memfileIndex = index            \n            hero = memfile\n        }\n    })\n    return hero\n  }\n//---------------------------------------------------------------------------------\n  populateMemoryFiles = (memfiles) => {\n\n    this.state.memfiles = memfiles\n    this.setState({activefile:this.getHeroFile()})\n  }\n//---------------------------------------------------------------------------------\n  populateSearchWords = (words) =>{\n    this.setState({searchWords:words})\n  }\n\n//------------------------------------------------------------------------\n\n  populateCloudInfo = (clouds) =>{\n    this.setState({memoryClouds:clouds})\n    mem.getCloudPeople (clouds,((people)=>{\n      this.setState({cloudPeople:people})\n    }))   \n  }\n\n//------------------------------------------------------------------------\n\n  \n  \n\n  userIsAuthorisedToEdit = () =>{\n    return true\n  }\n\n  //------------------------------------------------------------------------\n\n  deleteFileFromMemory =() =>{\n    console.log('delte file from memroy');\n    \n  }\n  \n  //------------------------------------------------------------------------\n\n\n  makeHeroFile = () =>{\n    console.log('make hero file');\n    \n  }\n  \n  //------------------------------------------------------------------------\n\n  handleAddTaggedPerson = (Person) =>{\n    \n    let tp = this.state.taggedPeople\n    if(!tp.find(dude => dude.userid === Person.userid)){\n      tp.push(Person)\n      tp.reverse()\n      this.setState({taggedPeople:tp})\n    }\n  }\n\n  //------------------------------------------------------------------------\n\n  handleRemoveFromCloud = ( Cloud ) =>{\n    let cl = []\n    this.state.memoryClouds.map(cloud =>{if(cloud.id !== Cloud.id) cl.push(cloud)})\n    this.populateCloudInfo(cl)\n\n  }\n\n  //------------------------------------------------------------------------\n\n  handleDeleteTaggedPerson = (Person) =>{\n    let tp = []\n    this.state.taggedPeople.map( p =>{if(p.userid !== Person.userid)tp.push(p)})\n    this.setState({taggedPeople:tp})\n    \n  }\n\n  //------------------------------------------------------------------------\n\n  handleAddCloud = (clouds) =>{\n    let cloud = clouds[0]\n    let cl = this.state.memoryClouds\n    \n    let newCloudID = parseInt(cloud.value)\n    if(!cl.find(newcl => newcl.id === newCloudID)){\n\n      cl.push({\n        id:newCloudID,\n        name:cloud.label\n      })\n      cl.reverse()\n      this.setState({memoryClouds:cl})\n      this.populateCloudInfo(cl)\n    }\n  }\n\n  //------------------------------------------------------------------------\n\n  activeFileisHero =() =>{\n    var afile = this.state.activefile\n    \n    if(afile){\n      if(afile.ishero){\n        return true\n      }else{\n        return false\n      }\n    }else{\n      return false\n    }\n  }\n  \n  //------------------------------------------------------------------------\n\n  render = () => {\n   \n  if(this.props.show){\n\n    let memoryContent     = this.renderMemoryContent()\n    let carouselControls  = this.renderCarouselControls()\n    return(\n      <div className= 'backdropStyle'>\n        <div className='modalStyle'>\n          {memoryContent}   \n          {carouselControls}\n        </div>\n      </div>\n    )    \n  }else{\n    return null\n  }    \n}\n\n//------------------------------------------------------------------------\n\nrenderMemoryContent = () => {\n    \n  const imageZone   = this.renderImageZone()\n  const storyZone   = this.renderStoryZone()\n  const detailsZone = this.renderDetailsZone()\n  \n  \n  return (\n      <div className='modalrow'>\n        {imageZone}\n        {storyZone}\n        {detailsZone}\n      </div>\n  )\n  \n}\n  \n//------------------------------------------------------------------------\n\nhandleSearchWordClick = (itemKey,upState) =>{\n  \n  const ind = this.state.searchWords.findIndex(item =>{return item.id === itemKey})\n  this.state.searchWords[ind].included = upState\n  this.setState({searchWords:this.state.searchWords})\n  \n}\n\n//------------------------------------------------------------------------\n\nrenderKeyWords =() =>{\n\n  return (\n    <Container  onDrop={e => this.setState({searchWords:this.applyDrag(this.state.searchWords,e)})}>\n    \n      {\n        this.state.searchWords.map((wordItem, idx) => {\n          return (\n            <Draggable className='wordListItem' key={'k'+idx}>\n              <CheckBox \n                itemKey = {wordItem.id}\n                onClick = {this.handleSearchWordClick}\n                upState = {wordItem.included} \n                downImg = {greycross} \n                upImg   = {tick} \n                label   = {wordItem.keyword}\n              />\n            </Draggable> \n          )\n        })\n      }\n    </Container>\n  )\n  \n}\n\n//------------------------------------------------------------------------\n\napplyDrag = (arr, dragResult) => {\n  const { removedIndex, addedIndex, payload } = dragResult;\n  if (removedIndex === null && addedIndex === null) return arr;\n  const result = [...arr];\n  let itemToAdd = payload;\n  if (removedIndex !== null) itemToAdd = result.splice(removedIndex, 1)[0];\n  if (addedIndex !== null) result.splice(addedIndex, 0, itemToAdd);\n  return result;\n};\n\n//------------------------------------------------------------------------\n\nrenderTaggedPeople =() =>{\n\n  const people  = this.state.taggedPeople.map(\n    p => {\n        return (\n          <li \n            className='wordListItem'\n            key={'p' + p.userid}>\n              <ImageLabel \n                data          = { p   }\n                leftImg       = { tag } \n                badge         = { x   } \n                onBadgeClick  = { this.handleDeleteTaggedPerson  }\n                label         = { p.firstname + ' ' + p.lastname }/>                                                        \n          </li>\n        )\n      })\n      if(this.state.author){\n        people.push(      \n          <li \n            className='wordListItem'\n            key={'a' + this.state.author.userid}>\n            <ImageLabel \n              leftImg = { author}\n              label =   { this.state.author.firstname + ' ' + this.state.author.lastname}/>\n          </li>\n        ) \n      }\n      people.reverse()   \n      people.push( <li > { DropSearch.peopleDropSearch(this.state.cloudPeople,this.handleAddTaggedPerson) } </li>)\n      \n      return people\n \n}\n\n//------------------------------------------------------------------------\n\nrenderDetails =() => {\n  \n  if(this.props.memory){    \n   return (\n      <div>\n        <li \n          className='wordListItem'\n          key={'location'}><ImageLabel leftImg = {globe} label = {this.props.memory.location}/>\n        </li>\n        <li \n          className='wordListItem'\n          key={'sss'}><ImageLabel leftImg = {calendar} label = {mem.getShortDate(this.props.memory.createdon) }/>\n        </li>\n      </div>\n   )\n  }\n  \n}\n\n//------------------------------------------------------------------------\n\nrenderClouds =() => {\n\n  const clouds  = this.state.memoryClouds.map(\n    cloud => {\n        return (\n          <li \n            className='wordListItem'\n            key={'cloud' + cloud.id}><ImageLabel \n              data          = { cloud }\n              badge         = { x   } \n              onBadgeClick  = { this.handleRemoveFromCloud  }\n              leftImg = {cloudIMG} \n              label = {cloud.name}/>                            \n          </li>\n        )\n      })\n      \n      clouds.push( <li > { DropSearch.cloudDropSearch(this.state.userClouds,null,true,true ,this.handleAddCloud,this.state.userid) } </li>)\n      return clouds\n\n}\n\n//------------------------------------------------------------------------\n\nrenderImageZone =()=>{\n\n  let editControls=null\n  \n  var heroImg = this.activeFileisHero() ? hero : heroOutline;\n\n  editControls = \n  <div className = 'imageEditConrols' >\n    <img  \n      className='closeBtn'\n      src = {trash}\n      onClick={this.deleteFileFromMemory} \n      />\n    <img  \n      className='closeBtn'\n      src = {heroImg}\n      onClick = {this.makeHeroFile}\n      />\n  </div>\n\n  return (\n    <div className='imgcolumn'>\n      <MemoryFileViewer \n        memfile={this.state.activefile}\n        thumbStyleClass={'memoryModalImage'}\n        fileStyleClass={'memoryModalImage'}\n      />\n      {editControls}\n    </div>\n  )\n}\n\nonTitleBlur = (e) => {\n  const newTitle = e.target.value\n  if(newTitle !== this.state.title) this.state.title = newTitle\n}\n//------------------------------------------------------------------------\n\nonDescriptionBlur = (e) => {\n  const newDescription = e.target.value\n  if(newDescription !== this.state.description) this.state.description = newDescription\n\n}\n//------------------------------------------------------------------------\n\nonStoryBlur = (e) => {\n  const newStory = e.target.value\n  if(newStory !== this.state.story) this.state.story = newStory\n}\n\n//------------------------------------------------------------------------\n\nhandleStoryChange = (event) =>{\n  let addarray = this.state.searchWords\n  let addarray2 = []\n  let story = event.target.value\n  let words = WordExctractor.extract(story,\n                                      {\n                                          language:\"english\",\n                                          remove_digits: true,\n                                          return_changed_case:true,\n                                          remove_duplicates: true\n                                      })\n    \n  // add any new words that exist in the story\n  words.map(word =>{\n      if(!this.searchWordExists(word)){\n        addarray.push({included:true,keyword:word,strength:0})       \n      }      \n  })\n\n  // remove any search words that now longer exist in the story\n  addarray.map(w =>{    \n    if(words.find(word => w.keyword === word) !== undefined){      \n      addarray2.push({included:w.included,keyword:w.keyword,strength:w.strength})\n    }   \n  })\n\n  this.setState({searchWords:addarray2,story:story})  \n}\n\n//------------------------------------------------------------------------\n\nsearchWordExists = (word) => {\n  return this.state.searchWords.find(wordItem => word === wordItem.keyword)    \n}\n\n//------------------------------------------------------------------------\n\nrenderStoryZone = () =>{\n  const mem = this.state\n \n    return (\n      <div className = 'infoColumn'>\n        <input \n            onBlur = { this.onTitleBlur } className='input-reset titleEdit' \n            type=\"text\"  defaultValue = { mem.title } placeholder='Title' id=\"title\" />\n        <input \n            onBlur = {this.onDescriptionBlur} className='input-reset descriptionEdit' \n            type=\"text\"  defaultValue = { mem.description } placeholder='Description' id=\"description\" />\n        <textarea\n            onBlur   = { this.onStoryBlur } className='input-reset storyEdit' onChange = { this.handleStoryChange } \n            type=\"text\"  defaultValue = { mem.story } placeholder='Description' id=\"description\" /> \n      </div> \n    )\n  \n}\n\n//------------------------------------------------------------------------\n\nrenderCornerControls =() =>{\n  let editBtn = null\n  if(this.userIsAuthorisedToEdit()){\n    editBtn=\n      <img  \n      className='closeBtn'                   \n      src = {edit}\n      onClick={this.toggleEditMode} />\n  }\n  return (\n    <div className='footer'>                        \n      <img  \n        className='closeBtn'                   \n        src = {x}\n        onClick={this.onHide} />\n        {editBtn}\n\n    </div>\n\n  )\n}\n//------------------------------------------------------------------------\n\n\n\nrenderDetailsZone = () => {\n\n  const keywords     = this.renderKeyWords()\n  const people       = this.renderTaggedPeople()\n  const details      = this.renderDetails()\n  const clouds       = this.renderClouds()\n  const cornerCtrls  = this.renderCornerControls()\n  \n\n  return (\n    <div className = 'detailsColumn'>\n      <div className = 'z40'> \n        <h4>Tags </h4>\n        <ul className='keyWordList scroll' >  { keywords } </ul>\n      </div>\n      <div className = 'z25'>\n        <h4>People</h4>\n        <ul className='peopleList scroll' >   { people   } </ul>\n      </div>\n      <div className = 'z15'>\n        <h4>Clouds</h4>\n        <ul className='cloudList scroll' >    { clouds   } </ul>\n      </div>\n      <div className = 'z15'>\n        <h4>Details</h4>\n        <ul className='detailsList ' >        { details  } </ul>\n      </div>\n      {cornerCtrls}              \n    </div>  \n  )\n}\n\n//------------------------------------------------------------------------\n\nhandleDropfiles = async (acceptedFiles) =>{\n  \n  const reader = new FileReader()\n  acceptedFiles.forEach((file) => {\n    \n    reader.onload = () => {\n      console.log('onload ' + file.name);\n      if(mem.canHandleDroppedFile(file.name)){\n        \n        console.log('can handle dropped file ' + file.name);\n        let mfs = this.state.memfiles\n        mfs.push(file)\n\n        let mfis = this.state.memfileImages\n        mfis.push(reader.result)\n\n        this.setState({memfiles:mfs,memfileImages:mfis})\n\n      }else{\n        alert('File type ' + mem.getExtension(file.name) + ' not yet implemented' )\n      }\n    }\n\n  reader.readAsArrayBuffer(file) \n\n  })\n}\n\n//------------------------------------------------------------------------\n\nprepAndUploadFile = (file)=>{\n\n  let commonfileName = this.state.author.userid + '-' + Date.now()\n  let ext = mem.getExtension(file.name)\n  let fname = commonfileName + '-original'  + '.' + ext\n  let tname = commonfileName + '-thumb'     + '.' + ext\n  let filebuffer = null\n  let newMemfiles = this.state.memfiles\n  let memfile = {\n    id:0,\n    memid:this.props.memory.memid,\n    fileurl:'',\n    ishero:false,\n    fileext:ext,\n    thumburl:'',\n    thumbext:ext,\n  }\n  \n  mem.compressImage(file,0.9)\n      .then(result =>{\n        if(result.success){\n          filebuffer = result.data\n          mem.resizeImage(filebuffer,1500)\n          .then(result =>{\n            if(result.success){ \n            mem.uploadFile(tname,result.data)\n            .then(result =>{\n              if(result.success){\n                memfile.thumburl = result.awsurl\n                newMemfiles.push(memfile)\n                this.setState({memfiles:newMemfiles})\n                mem.uploadFile(fname,filebuffer)\n                .then(result =>{\n                  if(result.success){\n                    let last = this.state.memfiles.length-1\n                    this.state.memfiles[last].fileurl=result.awsurl\n                    mem.addFileToMemory({\n                        originalURL:this.state.memfiles[last].fileurl,\n                        thumbURL:this.state.memfiles[last].thumburl\n                    },false,this.props.memory.memid)\n                    .then(result => {\n                      if(result.success){\n                        console.log('file upload success ! : new memory id :' + JSON.stringify(result));\n\n                      }\n                    })\n                  }\n                })\n              }\n            })\n            }\n          })\n        }\n        }) \n}\n\n//------------------------------------------------------------------------\n\nrenderCarouselControls = () => {\n\n  const mem = this.state\n  const mfiles = mem.memfileImages\n  \n  let thumbs = mfiles.map((mfile,index) =>{\n      return(<img key={'thumb'+index} className='thumb' src = {mfile} onClick={(index) =>{}}/>)})\n  \n  return (\n    <div className='controlbox'>\n      <img className='closeBtn' src = {left} onClick={this.goBack} /> \n      <Dropzone onDrop={acceptedFiles => this.handleDropfiles(acceptedFiles)}>\n        {\n          ({getRootProps, getInputProps}) => (              \n            <div className='thumbArrayEdit' {...getRootProps()}>\n              {thumbs}\n            </div>              \n          )\n        }\n      </Dropzone>\n      <img className='closeBtn' src = {right} onClick={this.goForward} /> \n    </div>\n  )  \n}\n\n//------------------------------------------------------------------------\n\ngoBack = (e) => {\n  \n  let ubound = this.state.memfiles.length-1\n  if(this.state.memfileIndex === 0){\n    this.state.memfileIndex = ubound \n  }else{\n    this.state.memfileIndex--\n  }\n  this.setState({activefile:this.state.memfiles[this.state.memfileIndex]})  \n}\n\ngoForward = (e) => {\n  \n    let ubound = this.state.memfiles.length-1\n    if(this.state.memfileIndex === ubound){\n      this.state.memfileIndex = 0 \n    }else{\n      this.state.memfileIndex++\n    }\n    this.setState({activefile:this.state.memfiles[this.state.memfileIndex]})\n  \n}\n\n};  \n\nexport default NewMemoryModal;\n"]},"metadata":{},"sourceType":"module"}