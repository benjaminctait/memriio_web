{"ast":null,"code":"var _jsxFileName = \"/Users/bentait/Desktop/memriio/memriio_web/src/components/memorymodal/newmemorymodal.js\";\nimport React from 'react';\nimport greycross from '../images/x-grey.png';\nimport tick from '../images/tick.png';\nimport tag from '../images/tag.png';\nimport globe from '../images/outline-globe.png';\nimport calendar from '../images/calendar.png';\nimport key from '../images/key.png';\nimport author from '../images/author.png';\nimport x from '../images/x-symbol.png';\nimport left from '../images/chevron-left.png';\nimport right from '../images/chevron-right.png';\nimport trash from '../images/trash.png';\nimport hero from '../images/hero-full.png';\nimport heroOutline from '../images/hero-outline-grey.png';\nimport cloudIMG from '../images/cloud.png';\nimport cloudupload from '../images/cloudupload.png';\nimport MemoryFileViewer from '../memoryviewer/memoryImageViewer';\nimport * as mem from '../memriioserver';\nimport * as DropSearch from '../dropsearch/dropsearch';\nimport WordExctractor from 'keyword-extractor';\nimport { Container, Draggable } from 'react-smooth-dnd';\nimport Dropzone, { useDropzone } from 'react-dropzone';\nimport './memorymodal.css';\nimport { CheckBox, ImageLabel } from '../buttons/buttons';\n\nclass NewMemoryModal extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      memid: 0,\n      createdon: '',\n      user: null,\n      title: '',\n      description: '',\n      location: '',\n      story: '',\n      cardtype: 0,\n      taggedPeople: [],\n      memoryClouds: [],\n      searchWords: [],\n      memfiles: [],\n      cloudPeople: [],\n      activefile: null,\n      userClouds: [],\n      memfileIndex: 0,\n      showSelectPeople: false,\n      showSelectClouds: false,\n      addPeopleRef: null,\n      addPeopleRect: null,\n      addCloudRef: null,\n      addCloudRect: null\n    };\n\n    this.onHide = () => {\n      this.setState({\n        showSelectPeople: false,\n        showSelectClouds: false\n      });\n      this.state = {\n        memid: 0,\n        createdon: '',\n        user: null,\n        title: '',\n        description: '',\n        location: '',\n        story: '',\n        cardtype: 0,\n        taggedPeople: [],\n        memoryClouds: [],\n        searchWords: [],\n        memfiles: [],\n        cloudPeople: [],\n        addPeopleRef: null,\n        addPeopleRect: null,\n        addCloudRef: null,\n        addCloudRect: null,\n        activefile: null,\n        userClouds: [],\n        memfileIndex: 0\n      };\n      this.props.onCancelNewMemory();\n    };\n\n    this.componentDidUpdate = (prevProps, prevState) => {\n      if (!this.state.user || prevProps.userid !== this.state.user.userid) {\n        mem.getUser(this.props.userid, user => {\n          this.setState({\n            user: user,\n            userClouds: this.props.userClouds,\n            createdon: Date.now()\n          });\n        });\n      }\n    };\n\n    this.getHeroFile = () => {\n      let hero = this.state.memfiles[0];\n      this.state.memfiles.map((memfile, index) => {\n        if (memfile.ishero) {\n          this.state.memfileIndex = index;\n          hero = memfile;\n        }\n      });\n      return hero;\n    };\n\n    this.populateMemoryFiles = memfiles => {\n      this.state.memfiles = memfiles;\n      this.setState({\n        activefile: this.getHeroFile()\n      });\n    };\n\n    this.populateSearchWords = words => {\n      this.setState({\n        searchWords: words\n      });\n    };\n\n    this.populateCloudInfo = clouds => {\n      this.setState({\n        memoryClouds: clouds\n      });\n      mem.getCloudPeople(clouds, people => {\n        this.setState({\n          cloudPeople: people\n        });\n      });\n    };\n\n    this.userIsAuthorisedToEdit = () => {\n      return true;\n    };\n\n    this.deleteFileFromMemory = () => {\n      console.log('delte file from memroy');\n    };\n\n    this.makeHeroFile = () => {\n      console.log('make hero file');\n    };\n\n    this.handleAddTaggedPerson = Person => {\n      this.handleHidePeopleSearch();\n      let tp = this.state.taggedPeople;\n\n      if (!tp.find(dude => dude.userid === Person.userid)) {\n        tp.push(Person);\n        tp.reverse();\n        this.setState({\n          taggedPeople: tp\n        });\n      }\n    };\n\n    this.handleRemoveFromCloud = Cloud => {\n      let cl = [];\n      this.state.memoryClouds.map(cloud => {\n        if (cloud.id !== Cloud.id) cl.push(cloud);\n      });\n      this.populateCloudInfo(cl);\n    };\n\n    this.handleDeleteTaggedPerson = Person => {\n      let tp = [];\n      this.state.taggedPeople.map(p => {\n        if (p.userid !== Person.userid) tp.push(p);\n      });\n      this.setState({\n        taggedPeople: tp\n      });\n    };\n\n    this.handleUploadMemory = () => {\n      let me = this.state;\n      let Promises = [];\n      let newMem = {\n        memid: 0,\n        userid: me.user.userid,\n        title: me.title,\n        description: me.description,\n        story: me.story,\n        cardtype: 0,\n        createdon: Date.now(),\n        location: ''\n      };\n      console.log('-----------------------------');\n      console.log('handleUploadMemory ');\n      mem.createMemoryID(me.user.userid, me.title, me.description, me.story).then(memid => {\n        memid = parseInt(memid);\n        newMem.memid = memid;\n        console.log('handleUploadMemory : new memory id : ' + memid);\n        this.state.memid = memid;\n        this.props.onUploading();\n        me.taggedPeople.map(person => {\n          Promises.push(mem.addTaggedPerson(memid, person.userid));\n        });\n        me.memoryClouds.map(cloud => {\n          Promises.push(mem.addTaggedCloud(memid, cloud.id));\n        });\n        console.log('handleUploadMemory : uploading ' + me.memfiles.length + ' files');\n        me.memfiles.map((memfile, idx) => {\n          if (mem.isSupportedImageFile(memfile.file.name)) {\n            console.log('handleUploadMemory : file ' + memfile.name + ' is an image');\n            Promises.push(this.prepAndUploadImageFile(memfile.file, memfile.isHero, idx));\n          } else if (mem.isSupportedVideoFile(memfile.file.name)) {\n            console.log('handleUploadMemory : file ' + memfile.name + ' is a video');\n            Promises.push(this.prepAndUploadVideoFile(memfile, memfile.isHero, idx));\n          }\n        });\n        Promises.push(mem.setMemorySearchWords(memid, me.searchWords));\n        console.log('Promises length ' + Promises.length);\n        Promise.all(Promises).then(values => {\n          console.log('handleUploadMemory() - upload complete for memory id ' + newMem.memid);\n          this.props.onAddNewMemory(newMem);\n        });\n      }, error => {\n        alert('this is an error ' + error);\n      });\n    };\n\n    this.handleAddCloud = clouds => {\n      this.handleHideCloudSearch();\n      let cloud = clouds[0];\n      let cl = this.state.memoryClouds;\n      let newCloudID = parseInt(cloud.value);\n\n      if (!cl.find(newcl => newcl.id === newCloudID)) {\n        cl.push({\n          id: newCloudID,\n          name: cloud.label\n        });\n        cl.reverse();\n        this.setState({\n          memoryClouds: cl\n        }, this.populateCloudInfo(cl));\n      }\n    };\n\n    this.handleShowPeopleSearch = (evnt, item) => {\n      this.setState({\n        showSelectPeople: true,\n        addPeopleRect: this.state.addPeopleRef.current.getBoundingClientRect()\n      });\n    };\n\n    this.handleHidePeopleSearch = () => {\n      this.setState({\n        showSelectPeople: false\n      });\n    };\n\n    this.handleShowcloudSearch = (evnt, item) => {\n      this.setState({\n        showSelectClouds: true,\n        addCloudRect: this.state.addCloudRef.current.getBoundingClientRect()\n      });\n    };\n\n    this.handleHideCloudSearch = () => {\n      this.setState({\n        showSelectClouds: false\n      });\n    };\n\n    this.activeFileisHero = () => {\n      var afile = this.state.activefile;\n\n      if (afile) {\n        if (afile.ishero) {\n          return true;\n        } else {\n          return false;\n        }\n      } else {\n        return false;\n      }\n    };\n\n    this.render = () => {\n      if (this.props.show) {\n        let memoryContent = this.renderMemoryContent();\n        let carouselControls = null;\n        if (this.state.memfiles.length > 1) carouselControls = this.renderCarouselControls();\n        return /*#__PURE__*/React.createElement(\"div\", {\n          className: \"backdropStyle\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 324,\n            columnNumber: 7\n          }\n        }, /*#__PURE__*/React.createElement(\"div\", {\n          className: \"modalStyle\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 325,\n            columnNumber: 9\n          }\n        }, memoryContent, carouselControls));\n      } else {\n        return null;\n      }\n    };\n\n    this.renderMemoryContent = () => {\n      const imageZone = this.renderImageZone();\n      const storyZone = this.renderStoryZone();\n      const detailsZone = this.renderDetailsZone();\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"modalrow\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 346,\n          columnNumber: 7\n        }\n      }, imageZone, storyZone, detailsZone);\n    };\n\n    this.handleSearchWordClick = (itemKey, upState) => {\n      const ind = this.state.searchWords.findIndex(item => {\n        return item.id === itemKey;\n      });\n      this.state.searchWords[ind].included = upState;\n      this.setState({\n        searchWords: this.state.searchWords\n      });\n    };\n\n    this.renderKeyWords = () => {\n      return /*#__PURE__*/React.createElement(Container, {\n        onDrop: e => this.setState({\n          searchWords: this.applyDrag(this.state.searchWords, e)\n        }),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 370,\n          columnNumber: 5\n        }\n      }, this.state.searchWords.map((wordItem, idx) => {\n        return /*#__PURE__*/React.createElement(Draggable, {\n          className: \"wordListItem\",\n          key: 'k' + idx,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 375,\n            columnNumber: 13\n          }\n        }, /*#__PURE__*/React.createElement(CheckBox, {\n          itemKey: wordItem.id,\n          onClick: this.handleSearchWordClick,\n          upState: wordItem.included,\n          downImg: greycross,\n          upImg: tick,\n          label: wordItem.keyword,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 376,\n            columnNumber: 15\n          }\n        }));\n      }));\n    };\n\n    this.applyDrag = (arr, dragResult) => {\n      const {\n        removedIndex,\n        addedIndex,\n        payload\n      } = dragResult;\n      if (removedIndex === null && addedIndex === null) return arr;\n      const result = [...arr];\n      let itemToAdd = payload;\n      if (removedIndex !== null) itemToAdd = result.splice(removedIndex, 1)[0];\n      if (addedIndex !== null) result.splice(addedIndex, 0, itemToAdd);\n      return result;\n    };\n\n    this.renderTaggedPeople = () => {\n      console.log('rendertagged ' + this.state.showSelectPeople);\n      const people = this.state.taggedPeople.map(p => {\n        return /*#__PURE__*/React.createElement(\"li\", {\n          className: \"wordListItem\",\n          key: 'p' + p.userid,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 412,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(ImageLabel, {\n          data: p,\n          leftImg: tag,\n          badge: x,\n          onBadgeClick: this.handleDeleteTaggedPerson,\n          label: p.firstname + ' ' + p.lastname,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 415,\n            columnNumber: 15\n          }\n        }));\n      });\n\n      if (this.state.user) {\n        people.push( /*#__PURE__*/React.createElement(\"li\", {\n          className: \"wordListItem\",\n          key: 'a' + this.state.user.userid,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 426,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(ImageLabel, {\n          leftImg: author,\n          label: this.state.user.firstname + ' ' + this.state.user.lastname,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 429,\n            columnNumber: 13\n          }\n        })));\n      }\n\n      people.reverse();\n\n      if (!this.state.showSelectPeople) {\n        people.push( /*#__PURE__*/React.createElement(\"li\", {\n          ref: this.state.addPeopleRef,\n          className: \"wordListItem\",\n          key: 'addPerson',\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 438,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(ImageLabel, {\n          onClick: this.handleShowPeopleSearch,\n          label: '+ add',\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 442,\n            columnNumber: 13\n          }\n        })));\n      }\n\n      return people;\n    };\n\n    this.renderDetails = () => {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 460,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"li\", {\n        className: \"wordListItem\",\n        key: 'location',\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 461,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(ImageLabel, {\n        leftImg: globe,\n        label: 'IMPLEMENT',\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 463,\n          columnNumber: 28\n        }\n      })), /*#__PURE__*/React.createElement(\"li\", {\n        className: \"wordListItem\",\n        key: 'sss',\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 465,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(ImageLabel, {\n        leftImg: calendar,\n        label: mem.getShortDate(this.state.createdon),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 467,\n          columnNumber: 23\n        }\n      })));\n    };\n\n    this.renderClouds = () => {\n      const clouds = this.state.memoryClouds.map(cloud => {\n        return /*#__PURE__*/React.createElement(\"li\", {\n          className: \"wordListItem\",\n          key: 'cloud' + cloud.id,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 480,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(ImageLabel, {\n          data: cloud,\n          badge: x,\n          onBadgeClick: this.handleRemoveFromCloud,\n          leftImg: cloudIMG,\n          label: cloud.name,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 482,\n            columnNumber: 38\n          }\n        }));\n      });\n\n      if (!this.state.showSelectClouds) {\n        clouds.push( /*#__PURE__*/React.createElement(\"li\", {\n          ref: this.state.addCloudRef,\n          className: \"wordListItem\",\n          key: 'addCloud',\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 495,\n            columnNumber: 13\n          }\n        }, /*#__PURE__*/React.createElement(ImageLabel, {\n          onClick: this.handleShowcloudSearch,\n          label: '+ add',\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 499,\n            columnNumber: 15\n          }\n        })));\n      }\n\n      return clouds;\n    };\n\n    this.renderDropHere = () => {\n      return /*#__PURE__*/React.createElement(Dropzone, {\n        onDrop: acceptedFiles => this.handleDropfiles(acceptedFiles),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 514,\n          columnNumber: 5\n        }\n      }, ({\n        getRootProps,\n        getInputProps\n      }) => /*#__PURE__*/React.createElement(\"div\", Object.assign({\n        className: \"dropHere\"\n      }, getRootProps(), {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 517,\n          columnNumber: 13\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"crossdots\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 518,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"dropText\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 519,\n          columnNumber: 17\n        }\n      }, \"FILE DROP\"))));\n    };\n\n    this.renderImageZone = () => {\n      let editControls = null;\n      let af = this.state.activefile;\n      let tempFile = null;\n      var heroImg = this.activeFileisHero() ? hero : heroOutline;\n      editControls = /*#__PURE__*/React.createElement(\"div\", {\n        className: \"imageEditConrols\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 540,\n          columnNumber: 3\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        className: \"closeBtn\",\n        src: trash,\n        onClick: this.deleteFileFromMemory,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 541,\n          columnNumber: 5\n        }\n      }), /*#__PURE__*/React.createElement(\"img\", {\n        className: \"closeBtn\",\n        src: heroImg,\n        onClick: this.makeHeroFile,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 546,\n          columnNumber: 5\n        }\n      }));\n\n      if (af) {\n        tempFile = {\n          fileurl: af.localurl,\n          ishero: af.ishero,\n          fileext: mem.getExtension(af.file.name),\n          thumburl: af.localurl,\n          thumbext: mem.getExtension(af.file.name)\n        };\n        return /*#__PURE__*/React.createElement(\"div\", {\n          className: \"imgcolumn\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 564,\n            columnNumber: 7\n          }\n        }, /*#__PURE__*/React.createElement(MemoryFileViewer, {\n          memfile: tempFile,\n          thumbStyleClass: 'memoryModalImage',\n          fileStyleClass: 'memoryModalImage',\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 565,\n            columnNumber: 9\n          }\n        }), editControls);\n      } else {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          className: \"imgcolumn\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 576,\n            columnNumber: 7\n          }\n        }, /*#__PURE__*/React.createElement(MemoryFileViewer, {\n          memfile: null,\n          thumbStyleClass: 'memoryModalImage',\n          fileStyleClass: 'memoryModalImage',\n          alternateRenderer: this.renderDropHere,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 577,\n            columnNumber: 9\n          }\n        }));\n      }\n    };\n\n    this.onTitleBlur = e => {\n      const newTitle = e.target.value;\n      if (newTitle !== this.state.title) this.state.title = newTitle;\n    };\n\n    this.onDescriptionBlur = e => {\n      const newDescription = e.target.value;\n      if (newDescription !== this.state.description) this.state.description = newDescription;\n    };\n\n    this.onStoryBlur = e => {\n      const newStory = e.target.value;\n      if (newStory !== this.state.story) this.state.story = newStory;\n    };\n\n    this.handleDescriptionChange = event => {\n      let fulltext = this.state.title + ' ' + this.state.story + ' ' + event.target.value;\n      this.addToSearchWords(fulltext);\n      this.setState({\n        description: event.target.value\n      });\n    };\n\n    this.handleTitleChange = event => {\n      let fulltext = this.state.description + ' ' + this.state.story + ' ' + event.target.value;\n      this.addToSearchWords(fulltext);\n      this.setState({\n        title: event.target.value\n      });\n    };\n\n    this.handleStoryChange = event => {\n      let fulltext = this.state.description + ' ' + this.state.title + ' ' + event.target.value;\n      this.addToSearchWords(fulltext);\n      this.setState({\n        story: event.target.value\n      });\n    };\n\n    this.addToSearchWords = textContent => {\n      let addarray = this.state.searchWords;\n      let addarray2 = [];\n      let words = WordExctractor.extract(textContent, {\n        language: \"english\",\n        remove_digits: true,\n        return_changed_case: true,\n        remove_duplicates: true\n      }); // add any new words that exist in the story\n\n      words.map(word => {\n        if (!this.searchWordExists(word)) {\n          addarray.push({\n            included: true,\n            keyword: word,\n            strength: 0\n          });\n        }\n      }); // remove any search words that now longer exist in the story\n\n      addarray.map(w => {\n        if (words.find(word => w.keyword === word) !== undefined) {\n          addarray2.push({\n            included: w.included,\n            keyword: w.keyword,\n            strength: w.strength\n          });\n        }\n      });\n      this.setState({\n        searchWords: addarray2\n      });\n    };\n\n    this.searchWordExists = word => {\n      return this.state.searchWords.find(wordItem => word === wordItem.keyword);\n    };\n\n    this.renderStoryZone = () => {\n      const mem = this.state;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"infoColumn\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 670,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        onBlur: this.onTitleBlur,\n        className: \"input-reset titleEdit\",\n        onChange: this.handleTitleChange,\n        type: \"text\",\n        defaultValue: mem.title,\n        placeholder: \"Title\",\n        id: \"title\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 671,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(\"input\", {\n        onBlur: this.onDescriptionBlur,\n        className: \"input-reset descriptionEdit\",\n        onChange: this.handleDescriptionChange,\n        type: \"text\",\n        defaultValue: mem.description,\n        placeholder: \"Description\",\n        id: \"description\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 674,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(\"textarea\", {\n        onBlur: this.onStoryBlur,\n        className: \"input-reset storyEdit\",\n        onChange: this.handleStoryChange,\n        type: \"text\",\n        defaultValue: mem.story,\n        placeholder: \"Description\",\n        id: \"description\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 677,\n          columnNumber: 9\n        }\n      }));\n    };\n\n    this.renderCornerControls = () => {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"footer\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 690,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        className: \"closeBtn\",\n        src: x,\n        onClick: this.onHide,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 691,\n          columnNumber: 7\n        }\n      }), /*#__PURE__*/React.createElement(\"img\", {\n        className: \"closeBtn\",\n        src: cloudupload,\n        onClick: this.handleUploadMemory,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 695,\n          columnNumber: 7\n        }\n      }));\n    };\n\n    this.renderPeopleDropdown = () => {\n      if (this.state.showSelectPeople) {\n        return (// cRect,people, callBack\n          DropSearch.peopleDropSearch(this.state.addPeopleRect, this.state.cloudPeople, this.handleAddTaggedPerson)\n        );\n      } else {\n        return null;\n      }\n    };\n\n    this.renderCloudDropdown = () => {\n      if (this.state.showSelectClouds) {\n        return (// cRect,clouds, selected,showmulti,keepInList,callBack,userid,\n          DropSearch.cloudDropSearch(this.state.addCloudRect, this.state.userClouds, null, true, true, this.handleAddCloud, this.state.userid)\n        );\n      } else {\n        return null;\n      }\n    };\n\n    this.renderDetailsZone = () => {\n      const keywords = this.renderKeyWords();\n      const people = this.renderTaggedPeople();\n      const details = this.renderDetails();\n      const clouds = this.renderClouds();\n      const cornerCtrls = this.renderCornerControls();\n      const cloudDropdown = this.renderCloudDropdown();\n      const peopleDropdown = this.renderPeopleDropdown();\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"detailsColumn\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 760,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"z40\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 761,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 762,\n          columnNumber: 9\n        }\n      }, \"Tags \"), /*#__PURE__*/React.createElement(\"ul\", {\n        className: \"keyWordList scroll\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 763,\n          columnNumber: 9\n        }\n      }, \"  \", keywords, \" \")), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"z25\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 765,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 766,\n          columnNumber: 9\n        }\n      }, \"People\"), /*#__PURE__*/React.createElement(\"ul\", {\n        className: \"peopleList scroll\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 767,\n          columnNumber: 9\n        }\n      }, \"   \", people, \" \")), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"z15\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 769,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 770,\n          columnNumber: 9\n        }\n      }, \"Clouds\"), /*#__PURE__*/React.createElement(\"ul\", {\n        className: \"cloudList scroll\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 771,\n          columnNumber: 9\n        }\n      }, \"    \", clouds, \" \")), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"z15\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 773,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 774,\n          columnNumber: 9\n        }\n      }, \"Details\"), /*#__PURE__*/React.createElement(\"ul\", {\n        className: \"detailsList \",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 775,\n          columnNumber: 9\n        }\n      }, \"        \", details, \" \")), cloudDropdown, peopleDropdown, cornerCtrls);\n    };\n\n    this.handleDropfiles = async acceptedFiles => {\n      const reader = new FileReader();\n      acceptedFiles.forEach(file => {\n        console.log('handleDropFile onload ' + JSON.stringify(file));\n\n        reader.onload = () => {\n          if (mem.canHandleDroppedFile(file.name)) {\n            console.log('dropped file is valid : ' + file.name);\n            let mfs = this.state.memfiles;\n            let newfile = {\n              file: file,\n              localurl: reader.result,\n              buffer: mem.dataURItoBlob(reader.result),\n              isHero: false\n            };\n            mfs.push(newfile);\n\n            if (!this.state.activefile) {\n              newfile.isHero = true;\n              this.state.activefile = newfile;\n            }\n\n            this.setState({\n              memfiles: mfs\n            });\n          } else {\n            alert('File type ' + mem.getExtension(file.name) + ' not yet implemented');\n          }\n        };\n\n        reader.readAsDataURL(file);\n      });\n    };\n\n    this.prepAndUploadImageFile = (file, isHero, uniqueID) => {\n      console.log('prepAndUploadImageFile : file ' + file.name);\n      let commonfileName = this.state.user.userid + '-' + this.state.memid + '-' + Date.now();\n      let ext = mem.getExtension(file.name);\n      let fname = commonfileName + '-' + uniqueID + '-original' + '.' + ext;\n      let tname = commonfileName + '-' + uniqueID + '-thumb' + '.' + ext;\n      let filebuffer = null;\n      let memfile = {\n        id: 0,\n        memid: this.state.memid,\n        fileurl: '',\n        ishero: false,\n        fileext: ext,\n        thumburl: '',\n        thumbext: ext\n      };\n      return new Promise((resolve, reject) => {\n        mem.compressImage(file, 0.9).then(result => {\n          if (result.success) {\n            filebuffer = result.data;\n            mem.resizeImage(filebuffer, 1500).then(result => {\n              if (result.success) {\n                mem.uploadFile(tname, result.data).then(result => {\n                  if (result.success) {\n                    memfile.thumburl = result.awsurl;\n                    mem.uploadFile(fname, filebuffer).then(result => {\n                      if (result.success) {\n                        memfile.fileurl = result.awsurl;\n                        console.log('prepUpload - memid    ' + this.state.memid);\n                        console.log('prepUpload - fileurl  ' + memfile.fileurl);\n                        console.log('prepUpload - thumburl ' + memfile.thumburl);\n                        mem.addFileToMemory({\n                          originalURL: memfile.fileurl,\n                          thumbURL: memfile.thumburl\n                        }, isHero, this.state.memid).then(result => {\n                          if (result.success) {\n                            resolve(result);\n                          } else {\n                            reject('failed to add file to memory');\n                          }\n                        });\n                      }\n                    });\n                  }\n                });\n              }\n            });\n          }\n        });\n      });\n    };\n\n    this.prepAndUploadVideoFile = (mfile, isHero, uniqueID) => {\n      console.log('prepAndUploadVideoFile : file ' + mfile.file.name);\n      let commonfileName = this.state.user.userid + '-' + this.state.memid + '-' + Date.now();\n      let ext = mem.getExtension(mfile.file.name);\n      let vFolder = commonfileName + '-' + uniqueID;\n      let originalfile = commonfileName + '-' + uniqueID + '-stream' + '.' + ext;\n      let memfile = {\n        id: 0,\n        memid: this.state.memid,\n        fileurl: '',\n        // this will be the original\n        ishero: false,\n        fileext: ext,\n        thumburl: '',\n        // this will be the transcoded version\n        thumbext: ''\n      };\n      return new Promise((resolve, reject) => {\n        mem.uploadFile(originalfile, mfile.buffer).then(result => {\n          console.log('prepAndUploadVideoFile : uploadFile ' + originalfile + ' was successfull ? ' + result.success);\n\n          if (result.success) {\n            memfile.fileurl = result.awsurl;\n            mem.transcodeVideoToHLS(originalfile, vFolder).then(result => {\n              console.log('prepAndUploadVideoFile : transcodeVid.. ' + vFolder + '/' + originalfile + ' was successfull ? ' + result.success);\n\n              if (result.success) {\n                memfile.thumburl = result.data;\n                memfile.thumbext = 'm3u8';\n                console.log('prepUpload - memid    ' + this.state.memid);\n                console.log('prepUpload - fileurl  ' + memfile.fileurl);\n                console.log('prepUpload - thumburl ' + memfile.thumburl);\n                mem.addFileToMemory({\n                  originalURL: memfile.fileurl,\n                  thumbURL: memfile.thumburl\n                }, isHero, this.state.memid).then(result => {\n                  console.log('prepAndUploadVideoFile : addfiletoMemory was successfull ? ' + result.success);\n\n                  if (result.success) {\n                    resolve(result);\n                  } else {\n                    reject('failed to add file to memory');\n                  }\n                });\n              }\n            });\n          }\n        });\n      });\n    };\n\n    this.renderCarouselControls = () => {\n      const mem = this.state;\n      const mfiles = mem.memfiles;\n      let thumbs = mfiles.map((mfile, index) => {\n        return /*#__PURE__*/React.createElement(\"img\", {\n          key: 'thumb' + index,\n          className: \"thumb\",\n          src: mfile.localurl,\n          onClick: index => {},\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 953,\n            columnNumber: 14\n          }\n        });\n      });\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"controlbox\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 956,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        className: \"closeBtn\",\n        src: left,\n        onClick: this.goBack,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 957,\n          columnNumber: 7\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"thumbArrayEdit\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 958,\n          columnNumber: 13\n        }\n      }, thumbs), /*#__PURE__*/React.createElement(\"img\", {\n        className: \"closeBtn\",\n        src: right,\n        onClick: this.goForward,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 961,\n          columnNumber: 7\n        }\n      }));\n    };\n\n    this.goBack = e => {\n      let ubound = this.state.memfiles.length - 1;\n\n      if (this.state.memfileIndex === 0) {\n        this.state.memfileIndex = ubound;\n      } else {\n        this.state.memfileIndex--;\n      }\n\n      this.setState({\n        activefile: this.state.memfiles[this.state.memfileIndex]\n      });\n    };\n\n    this.goForward = e => {\n      let ubound = this.state.memfiles.length - 1;\n\n      if (this.state.memfileIndex === ubound) {\n        this.state.memfileIndex = 0;\n      } else {\n        this.state.memfileIndex++;\n      }\n\n      this.setState({\n        activefile: this.state.memfiles[this.state.memfileIndex]\n      });\n    };\n\n    this.state.addPeopleRef = React.createRef();\n    this.state.addCloudRef = React.createRef();\n  }\n\n}\n\n;\nexport default NewMemoryModal;","map":{"version":3,"sources":["/Users/bentait/Desktop/memriio/memriio_web/src/components/memorymodal/newmemorymodal.js"],"names":["React","greycross","tick","tag","globe","calendar","key","author","x","left","right","trash","hero","heroOutline","cloudIMG","cloudupload","MemoryFileViewer","mem","DropSearch","WordExctractor","Container","Draggable","Dropzone","useDropzone","CheckBox","ImageLabel","NewMemoryModal","Component","constructor","props","state","memid","createdon","user","title","description","location","story","cardtype","taggedPeople","memoryClouds","searchWords","memfiles","cloudPeople","activefile","userClouds","memfileIndex","showSelectPeople","showSelectClouds","addPeopleRef","addPeopleRect","addCloudRef","addCloudRect","onHide","setState","onCancelNewMemory","componentDidUpdate","prevProps","prevState","userid","getUser","Date","now","getHeroFile","map","memfile","index","ishero","populateMemoryFiles","populateSearchWords","words","populateCloudInfo","clouds","getCloudPeople","people","userIsAuthorisedToEdit","deleteFileFromMemory","console","log","makeHeroFile","handleAddTaggedPerson","Person","handleHidePeopleSearch","tp","find","dude","push","reverse","handleRemoveFromCloud","Cloud","cl","cloud","id","handleDeleteTaggedPerson","p","handleUploadMemory","me","Promises","newMem","createMemoryID","then","parseInt","onUploading","person","addTaggedPerson","addTaggedCloud","length","idx","isSupportedImageFile","file","name","prepAndUploadImageFile","isHero","isSupportedVideoFile","prepAndUploadVideoFile","setMemorySearchWords","Promise","all","values","onAddNewMemory","error","alert","handleAddCloud","handleHideCloudSearch","newCloudID","value","newcl","label","handleShowPeopleSearch","evnt","item","current","getBoundingClientRect","handleShowcloudSearch","activeFileisHero","afile","render","show","memoryContent","renderMemoryContent","carouselControls","renderCarouselControls","imageZone","renderImageZone","storyZone","renderStoryZone","detailsZone","renderDetailsZone","handleSearchWordClick","itemKey","upState","ind","findIndex","included","renderKeyWords","e","applyDrag","wordItem","keyword","arr","dragResult","removedIndex","addedIndex","payload","result","itemToAdd","splice","renderTaggedPeople","firstname","lastname","renderDetails","getShortDate","renderClouds","renderDropHere","acceptedFiles","handleDropfiles","getRootProps","getInputProps","editControls","af","tempFile","heroImg","fileurl","localurl","fileext","getExtension","thumburl","thumbext","onTitleBlur","newTitle","target","onDescriptionBlur","newDescription","onStoryBlur","newStory","handleDescriptionChange","event","fulltext","addToSearchWords","handleTitleChange","handleStoryChange","textContent","addarray","addarray2","extract","language","remove_digits","return_changed_case","remove_duplicates","word","searchWordExists","strength","w","undefined","renderCornerControls","renderPeopleDropdown","peopleDropSearch","renderCloudDropdown","cloudDropSearch","keywords","details","cornerCtrls","cloudDropdown","peopleDropdown","reader","FileReader","forEach","JSON","stringify","onload","canHandleDroppedFile","mfs","newfile","buffer","dataURItoBlob","readAsDataURL","uniqueID","commonfileName","ext","fname","tname","filebuffer","resolve","reject","compressImage","success","data","resizeImage","uploadFile","awsurl","addFileToMemory","originalURL","thumbURL","mfile","vFolder","originalfile","transcodeVideoToHLS","mfiles","thumbs","goBack","goForward","ubound","createRef"],"mappings":"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","sourcesContent":["import React from 'react';\n\nimport greycross from '../images/x-grey.png'\nimport tick from '../images/tick.png'\nimport tag from '../images/tag.png'\nimport globe from '../images/outline-globe.png'\nimport calendar from '../images/calendar.png'\nimport key from '../images/key.png'\nimport author from '../images/author.png'\nimport x from '../images/x-symbol.png'\nimport left from '../images/chevron-left.png'\nimport right from '../images/chevron-right.png'\nimport trash from '../images/trash.png'\nimport hero from '../images/hero-full.png'\nimport heroOutline from '../images/hero-outline-grey.png'\nimport cloudIMG from '../images/cloud.png'\nimport cloudupload from '../images/cloudupload.png'\n\nimport MemoryFileViewer from '../memoryviewer/memoryImageViewer'\nimport * as mem from '../memriioserver'\nimport * as DropSearch from '../dropsearch/dropsearch'\n\nimport WordExctractor from 'keyword-extractor'\nimport { Container, Draggable} from 'react-smooth-dnd'\nimport Dropzone,{useDropzone} from 'react-dropzone'\n\nimport './memorymodal.css'\n\nimport {CheckBox,ImageLabel} from '../buttons/buttons'\n\nclass NewMemoryModal extends React.Component{\n  constructor(props) {\n    super(props);\n    this.state.addPeopleRef = React.createRef();\n    this.state.addCloudRef = React.createRef();\n  }\n\n    state ={\n       \n          memid:0,\n          createdon:'',\n          user:null,\n          title:'',\n          description:'',\n          location:'',\n          story:'',\n          cardtype:0,\n          taggedPeople:[],\n          memoryClouds:[],\n          searchWords:[],         \n          memfiles:[],\n          cloudPeople:[],\n     \n        activefile:null,\n        userClouds:[],\n        memfileIndex:0,\n\n        showSelectPeople:false,\n        showSelectClouds:false,\n        addPeopleRef:null,\n        addPeopleRect:null,\n        addCloudRef:null,\n        addCloudRect:null,\n    }\n\n//---------------------------------------------------------------------------------\n\nonHide = () =>{    \n  this.setState({showSelectPeople:false , showSelectClouds:false })\n  \n  this.state ={\n      memid:0,\n      createdon:'',\n      user:null,\n      title:'',\n      description:'',\n      location:'',\n      story:'',\n      cardtype:0,\n      taggedPeople:[],\n      memoryClouds:[],\n      searchWords:[],         \n      memfiles:[],\n      cloudPeople:[],\n\n      addPeopleRef:null,\n      addPeopleRect:null,\n      addCloudRef:null,\n      addCloudRect:null,\n\n    activefile:null,\n    userClouds:[],\n    memfileIndex:0,\n  }\n  \n  this.props.onCancelNewMemory()\n}\n//---------------------------------------------------------------------------------\n\ncomponentDidUpdate = (prevProps,prevState) =>{\n\n  if(!this.state.user || prevProps.userid !== this.state.user.userid)\n  {\n    mem.getUser(this.props.userid,(user => {\n\n      this.setState({user:user,userClouds:this.props.userClouds,createdon:Date.now()})\n      \n    }))\n  }\n}\n\n//---------------------------------------------------------------------------------\n\n  getHeroFile = () => {\n    \n    let hero = this.state.memfiles[0]\n\n    this.state.memfiles.map((memfile,index)=> {\n\n        if(memfile.ishero){         \n            this.state.memfileIndex = index            \n            hero = memfile\n        }\n    })\n    return hero\n  }\n//---------------------------------------------------------------------------------\n  populateMemoryFiles = (memfiles) => {\n\n    this.state.memfiles = memfiles\n    this.setState({activefile:this.getHeroFile()})\n  }\n//---------------------------------------------------------------------------------\n  populateSearchWords = (words) =>{\n    this.setState({searchWords:words})\n  }\n\n//------------------------------------------------------------------------\n\n  populateCloudInfo = (clouds) =>{\n    this.setState({memoryClouds:clouds})\n    mem.getCloudPeople (clouds,((people)=>{\n      this.setState({cloudPeople:people})\n    }))   \n  }\n\n//------------------------------------------------------------------------\n\n  userIsAuthorisedToEdit = () =>{\n    return true\n  }\n\n  //------------------------------------------------------------------------\n\n  deleteFileFromMemory =() =>{\n    console.log('delte file from memroy');\n    \n  }\n  \n  //------------------------------------------------------------------------\n\n\n  makeHeroFile = () =>{\n    console.log('make hero file');\n    \n  }\n  \n  //------------------------------------------------------------------------\n\n  handleAddTaggedPerson = (Person) =>{\n\n    this.handleHidePeopleSearch()\n    let tp = this.state.taggedPeople\n    if(!tp.find(dude => dude.userid === Person.userid)){\n      tp.push(Person)\n      tp.reverse()\n      this.setState({taggedPeople:tp})\n    }\n  }\n\n  //------------------------------------------------------------------------\n\n  handleRemoveFromCloud = ( Cloud ) =>{\n    let cl = []\n    this.state.memoryClouds.map(cloud =>{if(cloud.id !== Cloud.id) cl.push(cloud)})\n    this.populateCloudInfo(cl)\n\n  }\n\n  //------------------------------------------------------------------------\n\n  handleDeleteTaggedPerson = (Person) =>{\n    let tp = []\n    this.state.taggedPeople.map( p =>{if(p.userid !== Person.userid)tp.push(p)})\n    this.setState({taggedPeople:tp})\n    \n  }\n\n  //------------------------------------------------------------------------\n\n  handleUploadMemory = () =>{\n    let me = this.state\n    let Promises = []\n    let newMem = {\n      memid:0,\n      userid:me.user.userid,\n      title:me.title,\n      description:me.description,\n      story:me.story,\n      cardtype:0,\n      createdon:Date.now(),\n      location:''\n    }\n\n    console.log('-----------------------------');\n    console.log('handleUploadMemory ');\n    mem.createMemoryID(me.user.userid,me.title,me.description,me.story)\n    .then(memid =>{\n      memid = parseInt(memid)\n      newMem.memid = memid\n      console.log('handleUploadMemory : new memory id : ' + memid);\n      this.state.memid = memid\n      this.props.onUploading()\n      me.taggedPeople.map(person => { Promises.push( mem.addTaggedPerson ( memid,person.userid )) })\n      me.memoryClouds.map(cloud  => { Promises.push( mem.addTaggedCloud  ( memid,cloud.id ))})\n\n      console.log('handleUploadMemory : uploading ' + me.memfiles.length + ' files');\n      me.memfiles.map((memfile,idx)  =>  { \n        \n        if( mem.isSupportedImageFile( memfile.file.name ) ){\n          console.log('handleUploadMemory : file ' + memfile.name + ' is an image');\n          Promises.push(this.prepAndUploadImageFile ( memfile.file,memfile.isHero,idx)) \n\n        }else if( mem.isSupportedVideoFile( memfile.file.name )){\n\n          console.log('handleUploadMemory : file ' + memfile.name + ' is a video');\n          Promises.push( this.prepAndUploadVideoFile ( memfile,memfile.isHero,idx ) )\n        }\n\n      })        \n      Promises.push( mem.setMemorySearchWords ( memid,me.searchWords ) )\n      \n      console.log('Promises length ' + Promises.length);\n      Promise.all(Promises).then(values => {\n        console.log('handleUploadMemory() - upload complete for memory id ' + newMem.memid );\n        this.props.onAddNewMemory(newMem)\n      })\n\n       \n    },error =>{ alert ( 'this is an error ' + error )})\n  }\n\n  //------------------------------------------------------------------------\n  \n  \n  handleAddCloud = (clouds) =>{\n\n    this.handleHideCloudSearch()\n    let cloud = clouds[0]\n    let cl = this.state.memoryClouds\n    \n    let newCloudID = parseInt(cloud.value)\n    if(!cl.find(newcl => newcl.id === newCloudID)){\n\n      cl.push({\n        id:newCloudID,\n        name:cloud.label\n      })\n      cl.reverse()\n      this.setState({memoryClouds:cl},this.populateCloudInfo(cl)) \n    }\n  }\n\n  //------------------------------------------------------------------------\n\n\nhandleShowPeopleSearch = (evnt,item) =>{ \n  this.setState({ showSelectPeople:true , addPeopleRect:this.state.addPeopleRef.current.getBoundingClientRect() }) \n}\n\nhandleHidePeopleSearch = () => {\n  \n  this.setState({ showSelectPeople:false })\n}\n\n//------------------------------------------------------------------------\n\nhandleShowcloudSearch = (evnt,item) =>{ \n  this.setState({ showSelectClouds:true , addCloudRect:this.state.addCloudRef.current.getBoundingClientRect() })\n\n}\n\nhandleHideCloudSearch = () => {\n  \n  this.setState({showSelectClouds:false})\n}\n\n//------------------------------------------------------------------------\n  activeFileisHero =() =>{\n    var afile = this.state.activefile\n    \n    if(afile){\n      if(afile.ishero){\n        return true\n      }else{\n        return false\n      }\n    }else{\n      return false\n    }\n  }\n  \n  //------------------------------------------------------------------------\n\n  render = () => {\n   \n  if(this.props.show){\n\n    let memoryContent     = this.renderMemoryContent()\n    let carouselControls  = null\n    if(this.state.memfiles.length>1) carouselControls  = this.renderCarouselControls()\n    \n    return(\n      <div className= 'backdropStyle'>\n        <div className='modalStyle'>\n          {memoryContent}   \n          {carouselControls}\n        </div>\n      </div>\n    )    \n  }else{\n    return null\n  }    \n}\n\n//------------------------------------------------------------------------\n\nrenderMemoryContent = () => {\n    \n  const imageZone   = this.renderImageZone()\n  const storyZone   = this.renderStoryZone()\n  const detailsZone = this.renderDetailsZone()\n  \n  \n  return (\n      <div className='modalrow'>\n        {imageZone}\n        {storyZone}\n        {detailsZone}\n      </div>\n  )\n  \n}\n  \n//------------------------------------------------------------------------\n\nhandleSearchWordClick = (itemKey,upState) =>{\n  \n  const ind = this.state.searchWords.findIndex(item =>{return item.id === itemKey})\n  this.state.searchWords[ind].included = upState\n  this.setState({searchWords:this.state.searchWords})\n  \n}\n\n//------------------------------------------------------------------------\n\nrenderKeyWords =() =>{\n\n  return (\n    <Container  onDrop={e => this.setState({searchWords:this.applyDrag(this.state.searchWords,e)})}>\n    \n      {\n        this.state.searchWords.map((wordItem, idx) => {\n          return (\n            <Draggable className='wordListItem' key={'k'+idx}>\n              <CheckBox \n                itemKey = {wordItem.id}\n                onClick = {this.handleSearchWordClick}\n                upState = {wordItem.included} \n                downImg = {greycross} \n                upImg   = {tick} \n                label   = {wordItem.keyword}\n              />\n            </Draggable> \n          )\n        })\n      }\n    </Container>\n  )\n  \n}\n\n//------------------------------------------------------------------------\n\napplyDrag = (arr, dragResult) => {\n  const { removedIndex, addedIndex, payload } = dragResult;\n  if (removedIndex === null && addedIndex === null) return arr;\n  const result = [...arr];\n  let itemToAdd = payload;\n  if (removedIndex !== null) itemToAdd = result.splice(removedIndex, 1)[0];\n  if (addedIndex !== null) result.splice(addedIndex, 0, itemToAdd);\n  return result;\n};\n\n//------------------------------------------------------------------------\n\nrenderTaggedPeople =() =>{\nconsole.log('rendertagged ' + this.state.showSelectPeople);\n  const people  = this.state.taggedPeople.map(\n    p => {\n        return (\n          <li \n            className='wordListItem'\n            key={'p' + p.userid}>\n              <ImageLabel \n                data          = { p   }\n                leftImg       = { tag } \n                badge         = { x   } \n                onBadgeClick  = { this.handleDeleteTaggedPerson  }\n                label         = { p.firstname + ' ' + p.lastname }/>                                                        \n          </li>\n        )\n      })\n      if(this.state.user){\n        people.push(      \n          <li \n            className='wordListItem'\n            key={'a' + this.state.user.userid}>\n            <ImageLabel \n              leftImg = { author}\n              label =   { this.state.user.firstname + ' ' + this.state.user.lastname}/>\n          </li>\n        ) \n      }\n      people.reverse()   \n      if(!this.state.showSelectPeople){\n        people.push(      \n          <li \n            ref = { this.state.addPeopleRef } \n            className='wordListItem'\n            key={'addPerson'}>\n            <ImageLabel \n              \n              onClick = { this.handleShowPeopleSearch }\n              label   = { '+ add' }\n            />\n          </li>\n        )\n      }\n      \n      return people\n \n}\n\n//------------------------------------------------------------------------\n\nrenderDetails =() => {\n  \n  return (\n      <div>\n        <li \n          className='wordListItem'\n          key={'location'}><ImageLabel leftImg = {globe} label = {'IMPLEMENT'}/>\n        </li>\n        <li \n          className='wordListItem'\n          key={'sss'}><ImageLabel leftImg = {calendar} label = {mem.getShortDate(this.state.createdon) }/>\n        </li>\n      </div>\n   )\n}\n\n//------------------------------------------------------------------------\n\nrenderClouds =() => {\n\n  const clouds  = this.state.memoryClouds.map(\n    cloud => {\n        return (\n          <li \n            className='wordListItem'\n            key={'cloud' + cloud.id}><ImageLabel \n              data          = { cloud }\n              badge         = { x   } \n              onBadgeClick  = { this.handleRemoveFromCloud  }\n              leftImg = {cloudIMG} \n              label = {cloud.name}/>                            \n          </li>\n        )\n      })\n      \n      if(!this.state.showSelectClouds)\n        {\n          clouds.push(      \n            <li \n              ref = { this.state.addCloudRef }\n              className='wordListItem'\n              key={'addCloud'}>\n              <ImageLabel \n                onClick = { this.handleShowcloudSearch }\n                label =   { '+ add'}/>\n            </li>\n          ) \n        }\n      return clouds\n\n}\n\n//------------------------------------------------------------------------\n\nrenderDropHere = () => {\n\n  return (\n    <Dropzone onDrop={acceptedFiles => this.handleDropfiles(acceptedFiles)}>\n        {\n          ({getRootProps, getInputProps}) => (              \n            <div className='dropHere' {...getRootProps()}>\n              < div className = 'crossdots'>\n                < div className = 'dropText'>FILE DROP</div>\n              </div>\n            </div>    \n          )\n        }\n      </Dropzone>    \n  )\n\n}\n\n//------------------------------------------------------------------------\n\nrenderImageZone =()=>{\n\n  let editControls=null\n  let af = this.state.activefile\n  let tempFile = null\n  \n  var heroImg = this.activeFileisHero() ? hero : heroOutline;\n  \n  editControls = \n  <div className = 'imageEditConrols' >\n    <img  \n      className='closeBtn'\n      src = {trash}\n      onClick={this.deleteFileFromMemory} \n      />\n    <img  \n      className='closeBtn'\n      src = {heroImg}\n      onClick = {this.makeHeroFile}\n      />\n  </div>\n\n  if(af)\n  {\n    tempFile = \n    {\n      fileurl:af.localurl,\n      ishero:af.ishero,\n      fileext:mem.getExtension(af.file.name),\n      thumburl:af.localurl,\n      thumbext:mem.getExtension(af.file.name)\n    }\n    return (\n      <div className='imgcolumn'>\n        <MemoryFileViewer \n          memfile={tempFile}\n          thumbStyleClass={'memoryModalImage'}\n          fileStyleClass={'memoryModalImage'}\n        />\n        {editControls}\n      </div>\n    )\n  }else{\n    \n    return (\n      <div className='imgcolumn'>\n        <MemoryFileViewer \n          memfile           = { null }\n          thumbStyleClass   = { 'memoryModalImage'}\n          fileStyleClass    = { 'memoryModalImage'}\n          alternateRenderer = { this.renderDropHere }\n        />\n      </div>\n    )\n  }\n\n    \n}\n\n//------------------------------------------------------------------------\n\nonTitleBlur = (e) => {\n  const newTitle = e.target.value\n  if(newTitle !== this.state.title) this.state.title = newTitle\n}\n//------------------------------------------------------------------------\n\nonDescriptionBlur = (e) => {\n  const newDescription = e.target.value\n  if(newDescription !== this.state.description) this.state.description = newDescription\n\n}\n//------------------------------------------------------------------------\n\nonStoryBlur = (e) => {\n  const newStory = e.target.value\n  if(newStory !== this.state.story) this.state.story = newStory\n}\n\n//------------------------------------------------------------------------\n\nhandleDescriptionChange = (event) => {\n  let fulltext = this.state.title + ' ' + this.state.story + ' ' + event.target.value\n  this.addToSearchWords(fulltext)\n  this.setState({description:event.target.value})\n}\n\nhandleTitleChange       = (event) => {\n  let fulltext = this.state.description + ' ' + this.state.story + ' ' + event.target.value\n  this.addToSearchWords(fulltext) \n  this.setState({title:event.target.value})\n}\n\nhandleStoryChange       = (event) => {\n  let fulltext = this.state.description + ' ' + this.state.title + ' ' + event.target.value\n  this.addToSearchWords(fulltext)\n  this.setState({story:event.target.value})\n}\n\naddToSearchWords = (textContent) =>{\n  let addarray = this.state.searchWords\n  let addarray2 = []  \n  let words = WordExctractor.extract(textContent,\n                                      {\n                                          language:\"english\",\n                                          remove_digits: true,\n                                          return_changed_case:true,\n                                          remove_duplicates: true\n                                      })\n    \n  // add any new words that exist in the story\n  words.map(word =>{\n      if(!this.searchWordExists(word)){\n        addarray.push({included:true,keyword:word,strength:0})       \n      }      \n  })\n\n  // remove any search words that now longer exist in the story\n  addarray.map(w =>{    \n    if(words.find(word => w.keyword === word) !== undefined){      \n      addarray2.push({included:w.included,keyword:w.keyword,strength:w.strength})\n    }   \n  })\n\n  this.setState({searchWords:addarray2})  \n}\n\n//------------------------------------------------------------------------\n\nsearchWordExists = (word) => {\n  return this.state.searchWords.find(wordItem => word === wordItem.keyword)    \n}\n\n//------------------------------------------------------------------------\n\nrenderStoryZone = () =>{\n  const mem = this.state\n  \n    return (\n      <div className = 'infoColumn'>\n        <input \n            onBlur = { this.onTitleBlur } className='input-reset titleEdit' onChange = { this.handleTitleChange }\n            type=\"text\"  defaultValue = { mem.title } placeholder='Title' id=\"title\" />\n        <input \n            onBlur = {this.onDescriptionBlur} className='input-reset descriptionEdit'  onChange = { this.handleDescriptionChange }\n            type=\"text\"  defaultValue = { mem.description } placeholder='Description' id=\"description\" />\n        <textarea\n            onBlur   = { this.onStoryBlur } className='input-reset storyEdit' onChange = { this.handleStoryChange } \n            type=\"text\"  defaultValue = { mem.story } placeholder='Description' id=\"description\" /> \n      </div> \n    )\n  \n}\n\n//------------------------------------------------------------------------\n\nrenderCornerControls =() =>{\n  \n  return (\n    <div className='footer'>                        \n      <img  \n        className='closeBtn'                   \n        src = {x}\n        onClick={this.onHide} />\n      <img  \n        className='closeBtn'                   \n        src = {cloudupload}\n        onClick={this.handleUploadMemory} />\n    </div>\n  )\n}\n\n//------------------------------------------------------------------------\n\nrenderPeopleDropdown = () => {\n\n  if(this.state.showSelectPeople){\n    \n    return (\n      // cRect,people, callBack\n      DropSearch.peopleDropSearch(\n            this.state.addPeopleRect,\n            this.state.cloudPeople,\n            this.handleAddTaggedPerson\n      )\n  )\n  }else{\n    return null\n }\n}\n\n//------------------------------------------------------------------------\n\nrenderCloudDropdown = () => {\n\n \n  if(this.state.showSelectClouds){\n      return (\n        // cRect,clouds, selected,showmulti,keepInList,callBack,userid,\n        DropSearch.cloudDropSearch(\n              this.state.addCloudRect,\n              this.state.userClouds,\n              null,\n              true,\n              true ,\n              this.handleAddCloud,\n              this.state.userid              \n        )\n    )\n    }else{\n      return null\n   }\n}\n\n//------------------------------------------------------------------------\n\n\nrenderDetailsZone = () => {\n\n  const keywords     = this.renderKeyWords()\n  const people       = this.renderTaggedPeople()\n  const details      = this.renderDetails()\n  const clouds       = this.renderClouds()\n  const cornerCtrls  = this.renderCornerControls()\n  \n  const cloudDropdown   = this.renderCloudDropdown()\n  const peopleDropdown  = this.renderPeopleDropdown()\n\n  return (\n    <div className = 'detailsColumn'>\n      <div className = 'z40'> \n        <h4>Tags </h4>\n        <ul className='keyWordList scroll' >  { keywords } </ul>\n      </div>\n      <div className = 'z25'>\n        <h4>People</h4>\n        <ul className='peopleList scroll' >   { people   } </ul>\n      </div>\n      <div className = 'z15'>\n        <h4>Clouds</h4>\n        <ul className='cloudList scroll' >    { clouds   } </ul>\n      </div>\n      <div className = 'z15'>\n        <h4>Details</h4>\n        <ul className='detailsList ' >        { details  } </ul>\n      </div>\n      {cloudDropdown}\n      {peopleDropdown}\n      {cornerCtrls}              \n    </div>  \n  )\n}\n\n//------------------------------------------------------------------------\n\nhandleDropfiles = async (acceptedFiles) =>{\n  \n  const reader = new FileReader()\n  \n  acceptedFiles.forEach((file) => {\n    console.log('handleDropFile onload ' + JSON.stringify(file));\n    \n    reader.onload = () => {\n      \n      \n      if(mem.canHandleDroppedFile(file.name))\n      {\n        console.log('dropped file is valid : ' + file.name);\n        let mfs = this.state.memfiles\n        let newfile = \n        {\n            file:file,\n            localurl:reader.result,\n            buffer: mem.dataURItoBlob(reader.result),\n            isHero:false\n        }\n        mfs.push(newfile)\n\n        if(!this.state.activefile) {\n          newfile.isHero = true\n          this.state.activefile = newfile\n        }\n        this.setState({memfiles:mfs})\n\n      }else{\n        alert('File type ' + mem.getExtension(file.name) + ' not yet implemented' )\n      }\n    }\n  reader.readAsDataURL(file)\n\n  })\n}\n\n//------------------------------------------------------------------------\n\nprepAndUploadImageFile = (file, isHero, uniqueID)=>{\n\n  console.log('prepAndUploadImageFile : file ' + file.name )\n  let commonfileName = this.state.user.userid + '-' + this.state.memid + '-' + Date.now()\n  let ext = mem.getExtension(file.name)\n  let fname = commonfileName + '-' + uniqueID + '-original'  + '.' + ext\n  let tname = commonfileName + '-' + uniqueID + '-thumb'     + '.' + ext\n  let filebuffer = null\n  \n  let memfile = {\n    id:0,\n    memid:this.state.memid,\n    fileurl:'',\n    ishero:false,\n    fileext:ext,\n    thumburl:'',\n    thumbext:ext,\n  }\n  \n  return new Promise((resolve,reject) =>{\n  \n    mem.compressImage(file,0.9)\n        .then(result =>{\n          if(result.success){\n            filebuffer = result.data\n            mem.resizeImage(filebuffer,1500)\n            .then(result =>{\n              if(result.success){ \n              mem.uploadFile(tname,result.data)\n              .then(result =>{\n                if(result.success){\n                  memfile.thumburl = result.awsurl\n                  mem.uploadFile(fname,filebuffer)\n                  .then(result =>{\n                    if(result.success){\n                      memfile.fileurl=result.awsurl\n                      console.log('prepUpload - memid    ' + this.state.memid );\n                      console.log('prepUpload - fileurl  ' + memfile.fileurl  );\n                      console.log('prepUpload - thumburl ' + memfile.thumburl );\n                      mem.addFileToMemory({\n                          originalURL:memfile.fileurl,\n                          thumbURL:memfile.thumburl\n                      },isHero,this.state.memid)\n                      .then(result => {\n                        if(result.success){\n                          resolve(result)\n                        }else{\n                          reject('failed to add file to memory')\n                        }\n                      })\n                    }\n                  })\n                }\n              })\n              }\n            })\n          }\n          }) \n    })\n}\n\n//------------------------------------------------------------------------\n\nprepAndUploadVideoFile = (mfile, isHero, uniqueID)=>{\n\n  console.log('prepAndUploadVideoFile : file ' + mfile.file.name )\n  let commonfileName = this.state.user.userid + '-' + this.state.memid + '-' + Date.now()\n  let ext = mem.getExtension(mfile.file.name)\n\n  let vFolder       = commonfileName + '-' + uniqueID\n  let originalfile  = commonfileName + '-' + uniqueID + '-stream'    + '.' + ext\n  \n  let memfile = {\n    id        : 0,\n    memid     : this.state.memid,\n    fileurl   : '',     // this will be the original\n    ishero    : false,\n    fileext   : ext,    \n    thumburl  : '',    // this will be the transcoded version\n    thumbext  : '',\n  }\n  \n  return new Promise((resolve,reject) =>{\n    \n    mem.uploadFile(originalfile,mfile.buffer)\n    .then(result =>{\n      console.log('prepAndUploadVideoFile : uploadFile ' + originalfile + ' was successfull ? ' + result.success )\n      if(result.success){\n        memfile.fileurl = result.awsurl\n        mem.transcodeVideoToHLS( originalfile , vFolder )\n        .then(result =>{\n          console.log('prepAndUploadVideoFile : transcodeVid.. ' + vFolder+'/'+originalfile + ' was successfull ? ' + result.success )\n          if(result.success){\n            memfile.thumburl = result.data\n            memfile.thumbext = 'm3u8'\n\n            console.log('prepUpload - memid    ' + this.state.memid );\n            console.log('prepUpload - fileurl  ' + memfile.fileurl  );\n            console.log('prepUpload - thumburl ' + memfile.thumburl );\n\n            mem.addFileToMemory({\n                originalURL:memfile.fileurl,\n                thumbURL:memfile.thumburl\n            },isHero,this.state.memid)\n            .then(result => {\n              console.log('prepAndUploadVideoFile : addfiletoMemory was successfull ? ' + result.success )\n              if(result.success){\n                resolve(result)\n              }else{\n                reject('failed to add file to memory')\n              }\n            })\n          }\n        })\n      }\n    })        \n  })\n}\n\n//------------------------------------------------------------------------\n\nrenderCarouselControls = () => {\n\n  const mem = this.state\n  const mfiles = mem.memfiles\n\n  let thumbs = mfiles.map((mfile,index) =>{\n      return(<img key={'thumb'+index} className='thumb' src = {mfile.localurl} onClick={(index) =>{}}/>)})\n  \n  return (\n    <div className='controlbox'>\n      <img className='closeBtn' src = {left} onClick={this.goBack} />                  \n            <div className='thumbArrayEdit' >\n              {thumbs}\n            </div>        \n      <img className='closeBtn' src = {right} onClick={this.goForward} /> \n    </div>\n  )  \n}\n\n//------------------------------------------------------------------------\n\ngoBack = (e) => {\n  \n  let ubound = this.state.memfiles.length-1\n  if(this.state.memfileIndex === 0){\n    this.state.memfileIndex = ubound \n  }else{\n    this.state.memfileIndex--\n  }\n  this.setState({activefile:this.state.memfiles[this.state.memfileIndex]})  \n}\n\ngoForward = (e) => {\n  \n    let ubound = this.state.memfiles.length-1\n    if(this.state.memfileIndex === ubound){\n      this.state.memfileIndex = 0 \n    }else{\n      this.state.memfileIndex++\n    }\n    this.setState({activefile:this.state.memfiles[this.state.memfileIndex]})\n  \n}\n\n};  \n\nexport default NewMemoryModal;\n"]},"metadata":{},"sourceType":"module"}