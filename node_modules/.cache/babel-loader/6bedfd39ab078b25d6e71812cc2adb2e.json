{"ast":null,"code":"var _jsxFileName = \"/Users/bentait/Desktop/memriio/memriio_web/src/components/memorymodal/memorymodal.js\";\nimport React from 'react';\nimport tick from '../images/checkmark.png';\nimport tag from '../images/tag.png';\nimport author from '../images/author.png';\nimport x from '../images/x-symbol.png';\nimport edit from '../images/edit.png';\nimport left from '../images/chevron-left.png';\nimport right from '../images/chevron-right.png';\nimport trash from '../images/trash.png';\nimport hero from '../images/hero-full.png';\nimport heroOutline from '../images/hero-outline-grey.png';\nimport MemoryFileViewer from '../memoryviewer/memoryImageViewer';\nimport * as Memriio from '../memriioserver';\nimport WordExctractor from 'keyword-extractor';\nimport * as Utils from './utils';\nimport './memorymodal.css';\nimport { getAllMemoryFiles, getTaggedPeople, getMemoryClouds, getMemorySearchWords, getCloudPeople, getUser } from '../memriioserver';\nimport { CheckBox, SubTag, ImageLabel } from '../buttons/buttons';\n\nclass MemoryModal extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      memory: null,\n      taggedPeople: [],\n      memoryClouds: [],\n      searchWords: [],\n      memfiles: null,\n      cloudPeople: [],\n      userClouds: [],\n      activefile: null,\n      author: null,\n      memfileIndex: 0,\n      editMode: false\n    };\n\n    this.onHide = () => {\n      this.state.editMode = false;\n      this.props.onHideModal(this.props.memory);\n    };\n\n    this.componentDidUpdate = (prevProps, prevState) => {\n      if (this.props.memory) {\n        if (!prevProps.memory || this.props.memory.memid !== prevProps.memory.memid) {\n          this.populateMemoryFiles(this.props.memfiles);\n          getUser(this.props.memory.userid, author => {\n            this.setState({\n              author: author\n            });\n            console.log('Author + ' + JSON.stringify(author));\n          });\n          getTaggedPeople(this.props.memory.memid, people => {\n            this.setState({\n              taggedPeople: people\n            });\n          });\n          getMemoryClouds(this.props.memory.memid, clouds => {\n            this.populateCloudInfo(clouds);\n          });\n          getMemorySearchWords(this.props.memory.memid, words => {\n            this.populateSearchWords(words);\n          });\n        }\n      }\n    };\n\n    this.getHeroFile = () => {\n      this.state.memfileIndex = 0;\n      let hero = this.state.memfiles[0];\n      this.state.memfiles.map((memfile, index) => {\n        if (memfile.ishero) {\n          this.state.memfileIndex = index;\n          hero = memfile;\n        }\n      });\n      return hero;\n    };\n\n    this.populateMemoryFiles = memfiles => {\n      this.state.memfiles = memfiles;\n      this.setState({\n        activefile: this.getHeroFile()\n      });\n    };\n\n    this.populateSearchWords = words => {\n      this.setState({\n        searchWords: words\n      });\n    };\n\n    this.populateCloudInfo = clouds => {\n      this.setState({\n        memoryClouds: clouds\n      });\n      getCloudPeople(clouds, people => {\n        this.setState({\n          cloudPeople: people\n        });\n      });\n    };\n\n    this.toggleEditMode = () => {\n      this.setState({\n        editMode: !this.state.editMode\n      });\n    };\n\n    this.userIsAuthorisedToEdit = () => {\n      return true;\n    };\n\n    this.deleteFileFromMemory = () => {\n      console.log('delte file from memroy');\n    };\n\n    this.makeHeroFile = () => {\n      console.log('make hero file');\n    };\n\n    this.activeFileisHero = () => {\n      var afile = this.state.activefile;\n\n      if (afile) {\n        if (afile.ishero) {\n          return true;\n        } else {\n          return false;\n        }\n      } else {\n        return false;\n      }\n    };\n\n    this.renderMemoryContent = () => {\n      const imageZone = this.renderImageZone();\n      const storyZone = this.renderStoryZone();\n      const detailsZone = this.renderDetailsZone();\n\n      if (this.state.activefile) {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          className: \"modalrow\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 182,\n            columnNumber: 9\n          }\n        }, imageZone, storyZone, detailsZone);\n      } else {\n        return null;\n      }\n    };\n\n    this.renderKeyWords = () => {\n      if (this.state.editMode) {\n        return /*#__PURE__*/React.createElement(\"ul\", {\n          className: \"wordList\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 203,\n            columnNumber: 7\n          }\n        }, \" \", this.state.searchWords.map((wordItem, idx) => {\n          return /*#__PURE__*/React.createElement(\"li\", {\n            className: \"wordListItem\",\n            key: 'k' + idx,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 206,\n              columnNumber: 11\n            }\n          }, /*#__PURE__*/React.createElement(CheckBox, {\n            checkedImg: tick,\n            label: wordItem.keyword,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 207,\n              columnNumber: 13\n            }\n          }));\n        }));\n      } else {\n        return /*#__PURE__*/React.createElement(\"ul\", {\n          className: \"wordList\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 213,\n            columnNumber: 7\n          }\n        }, \" \", this.state.searchWords.map((wordItem, idx) => {\n          return /*#__PURE__*/React.createElement(\"li\", {\n            className: \"wordListItem\",\n            key: 'k' + idx,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 216,\n              columnNumber: 11\n            }\n          }, /*#__PURE__*/React.createElement(CheckBox, {\n            checkedImg: tick,\n            label: wordItem.keyword,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 217,\n              columnNumber: 13\n            }\n          }));\n        }));\n      }\n    };\n\n    this.renderTaggedPeople = () => {\n      const people = this.state.taggedPeople.map(p => {\n        return /*#__PURE__*/React.createElement(\"li\", {\n          className: \"wordListItem\",\n          key: 't' + p.userid,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 230,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(ImageLabel, {\n          img: tag,\n          label: p.firstname + ' ' + p.lastname,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 232,\n            columnNumber: 34\n          }\n        }));\n      });\n\n      if (this.state.author) {\n        people.push( /*#__PURE__*/React.createElement(\"li\", {\n          key: 'a' + this.state.author.userid,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 238,\n            columnNumber: 11\n          }\n        }, /*#__PURE__*/React.createElement(ImageLabel, {\n          img: author,\n          label: this.state.author.firstname + ' ' + this.state.author.lastname,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 239,\n            columnNumber: 13\n          }\n        })));\n      }\n\n      people.reverse();\n      return people;\n    };\n\n    this.renderDetails = () => {\n      const details = /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"li\", {\n        className: \"wordListItem\",\n        key: 'location',\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 254,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(ImageLabel, {\n        img: tag,\n        label: this.props.memory.location,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 26\n        }\n      })), /*#__PURE__*/React.createElement(\"li\", {\n        className: \"wordListItem\",\n        key: 'sss',\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 258,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(ImageLabel, {\n        img: tag,\n        label: this.props.memory.createdon,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 260,\n          columnNumber: 21\n        }\n      })));\n      return details;\n    };\n\n    this.renderImageZone = () => {\n      let editControls = null;\n\n      if (this.state.editMode) {\n        var heroImg = this.activeFileisHero() ? hero : heroOutline;\n        editControls = /*#__PURE__*/React.createElement(\"div\", {\n          className: \"imageEditConrols\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 275,\n            columnNumber: 5\n          }\n        }, /*#__PURE__*/React.createElement(\"img\", {\n          className: \"closeBtn\",\n          src: trash,\n          onClick: this.deleteFileFromMemory,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 276,\n            columnNumber: 7\n          }\n        }), /*#__PURE__*/React.createElement(\"img\", {\n          className: \"closeBtn\",\n          src: heroImg,\n          onClick: this.makeHeroFile,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 281,\n            columnNumber: 7\n          }\n        }));\n      }\n\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"imgcolumn\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 290,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(MemoryFileViewer, {\n        memfile: this.state.activefile,\n        thumbStyleClass: 'memoryModalImage',\n        fileStyleClass: 'memoryModalImage',\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 291,\n          columnNumber: 7\n        }\n      }), editControls);\n    };\n\n    this.onTitleBlur = e => {\n      const newTitle = e.target.value;\n\n      if (newTitle !== this.props.memory.title) {\n        Memriio.updateTitle(this.props.memory.memid, newTitle);\n      }\n    };\n\n    this.onDescriptionBlur = e => {\n      const newDescription = e.target.value;\n\n      if (newDescription !== this.props.memory.description) {\n        Memriio.updateDescription(this.props.memory.memid, newDescription);\n      }\n    };\n\n    this.onStoryBlur = e => {\n      const newStory = e.target.value;\n\n      if (newStory !== this.props.memory.story) {\n        Memriio.updateStory(this.props.memory.memid, newStory);\n      }\n    };\n\n    this.handleStoryChange = event => {\n      let addarray = this.state.searchWords;\n      let story = event.target.value;\n      let words = WordExctractor.extract(story, {\n        language: \"english\",\n        remove_digits: true,\n        return_changed_case: true,\n        remove_duplicates: true\n      });\n      words.map(word => {\n        if (!this.searchWordExists(word)) {\n          addarray.push({\n            included: true,\n            keyword: word,\n            strength: 0\n          });\n          console.log('word added' + word);\n        }\n      });\n      this.setState({\n        searchWords: addarray,\n        story: story\n      });\n    };\n\n    this.searchWordExists = word => {\n      return this.state.searchWords.find(wordItem => word === wordItem.keyword);\n    };\n\n    this.renderStoryZone = () => {\n      const mem = this.props.memory;\n\n      if (this.state.editMode) {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          className: \"infoColumn\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 359,\n            columnNumber: 7\n          }\n        }, /*#__PURE__*/React.createElement(\"input\", {\n          onBlur: this.onTitleBlur,\n          className: \"input-reset titleEdit\",\n          type: \"text\",\n          defaultValue: mem.title,\n          placeholder: \"Title\",\n          id: \"title\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 360,\n            columnNumber: 9\n          }\n        }), /*#__PURE__*/React.createElement(\"input\", {\n          onBlur: this.onDescriptionBlur,\n          className: \"input-reset descriptionEdit\",\n          type: \"text\",\n          defaultValue: mem.description,\n          placeholder: \"Description\",\n          id: \"description\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 363,\n            columnNumber: 9\n          }\n        }), /*#__PURE__*/React.createElement(\"textarea\", {\n          onBlur: this.onStoryBlur,\n          className: \"input-reset storyEdit\",\n          onChange: this.handleStoryChange,\n          type: \"text\",\n          defaultValue: mem.story,\n          placeholder: \"Description\",\n          id: \"description\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 366,\n            columnNumber: 9\n          }\n        }));\n      } else {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          className: \"infoColumn\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 373,\n            columnNumber: 7\n          }\n        }, /*#__PURE__*/React.createElement(\"h4\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 374,\n            columnNumber: 9\n          }\n        }, mem.title, \" \"), /*#__PURE__*/React.createElement(\"p\", {\n          className: \"f6 lh-copy i measure mt2 mid-gray\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 375,\n            columnNumber: 9\n          }\n        }, mem.description), /*#__PURE__*/React.createElement(\"p\", {\n          className: \"f6 lh-copy measure mt2 black\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 376,\n            columnNumber: 9\n          }\n        }, \" \", mem.story, \" \"));\n      }\n    };\n\n    this.renderCornerControls = () => {\n      let editBtn = null;\n\n      if (this.userIsAuthorisedToEdit()) {\n        editBtn = /*#__PURE__*/React.createElement(\"img\", {\n          className: \"closeBtn\",\n          src: edit,\n          onClick: this.toggleEditMode,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 389,\n            columnNumber: 7\n          }\n        });\n      }\n\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"footer\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 395,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        className: \"closeBtn\",\n        src: x,\n        onClick: this.onHide,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 396,\n          columnNumber: 7\n        }\n      }), editBtn);\n    };\n\n    this.renderDetailsZone = () => {\n      const keywords = this.renderKeyWords();\n      const people = this.renderTaggedPeople();\n      const details = this.renderDetails();\n      const cornderCtrls = this.renderCornerControls();\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"detailsColumn\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 416,\n          columnNumber: 5\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 417,\n          columnNumber: 7\n        }\n      }, \"Tags \"), keywords, /*#__PURE__*/React.createElement(\"h4\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 419,\n          columnNumber: 7\n        }\n      }, \"People\"), /*#__PURE__*/React.createElement(\"ul\", {\n        className: \"wordList\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 420,\n          columnNumber: 7\n        }\n      }, \" \", people, \" \"), /*#__PURE__*/React.createElement(\"h4\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 421,\n          columnNumber: 7\n        }\n      }, \"Details\"), /*#__PURE__*/React.createElement(\"ul\", {\n        className: \"wordList\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 422,\n          columnNumber: 7\n        }\n      }, \" \", details, \" \"), cornderCtrls);\n    };\n\n    this.renderCarouselControls = () => {\n      if (this.state.memfiles) {\n        const mem = this.props.memory;\n        const mfiles = this.state.memfiles;\n        const thumbs = mfiles.map((mfile, index) => {\n          return /*#__PURE__*/React.createElement(\"img\", {\n            key: 'thumb' + index,\n            className: \"thumb\",\n            src: mfile.thumburl,\n            onClick: index => {},\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 436,\n              columnNumber: 11\n            }\n          });\n        });\n        return /*#__PURE__*/React.createElement(\"div\", {\n          className: \"controlbox\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 440,\n            columnNumber: 7\n          }\n        }, /*#__PURE__*/React.createElement(\"img\", {\n          className: \"closeBtn\",\n          src: left,\n          onClick: this.goBack,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 441,\n            columnNumber: 9\n          }\n        }), /*#__PURE__*/React.createElement(\"div\", {\n          className: \"thumbArray\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 442,\n            columnNumber: 9\n          }\n        }, thumbs), /*#__PURE__*/React.createElement(\"img\", {\n          className: \"closeBtn\",\n          src: right,\n          onClick: this.goForward,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 445,\n            columnNumber: 9\n          }\n        }));\n      } else {\n        return null;\n      }\n    };\n\n    this.goBack = e => {\n      if (this.state.memfiles) {\n        let ubound = this.state.memfiles.length - 1;\n\n        if (this.state.memfileIndex === 0) {\n          this.state.memfileIndex = ubound;\n        } else {\n          this.state.memfileIndex--;\n        }\n\n        this.setState({\n          activefile: this.state.memfiles[this.state.memfileIndex]\n        });\n      }\n    };\n\n    this.goForward = e => {\n      if (this.state.memfiles) {\n        let ubound = this.state.memfiles.length - 1;\n\n        if (this.state.memfileIndex === ubound) {\n          this.state.memfileIndex = 0;\n        } else {\n          this.state.memfileIndex++;\n        }\n\n        this.setState({\n          activefile: this.state.memfiles[this.state.memfileIndex]\n        });\n      }\n    };\n  }\n\n  //------------------------------------------------------------------------\n  render() {\n    if (this.props.show) {\n      let memoryContent = this.renderMemoryContent();\n      let carouselControls = this.renderCarouselControls();\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"backdropStyle\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"modalStyle\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 11\n        }\n      }, memoryContent, carouselControls));\n    } else {\n      return null;\n    }\n  } //------------------------------------------------------------------------\n\n\n}\n\n;\nexport default MemoryModal;","map":{"version":3,"sources":["/Users/bentait/Desktop/memriio/memriio_web/src/components/memorymodal/memorymodal.js"],"names":["React","tick","tag","author","x","edit","left","right","trash","hero","heroOutline","MemoryFileViewer","Memriio","WordExctractor","Utils","getAllMemoryFiles","getTaggedPeople","getMemoryClouds","getMemorySearchWords","getCloudPeople","getUser","CheckBox","SubTag","ImageLabel","MemoryModal","Component","state","memory","taggedPeople","memoryClouds","searchWords","memfiles","cloudPeople","userClouds","activefile","memfileIndex","editMode","onHide","props","onHideModal","componentDidUpdate","prevProps","prevState","memid","populateMemoryFiles","userid","setState","console","log","JSON","stringify","people","clouds","populateCloudInfo","words","populateSearchWords","getHeroFile","map","memfile","index","ishero","toggleEditMode","userIsAuthorisedToEdit","deleteFileFromMemory","makeHeroFile","activeFileisHero","afile","renderMemoryContent","imageZone","renderImageZone","storyZone","renderStoryZone","detailsZone","renderDetailsZone","renderKeyWords","wordItem","idx","keyword","renderTaggedPeople","p","firstname","lastname","push","reverse","renderDetails","details","location","createdon","editControls","heroImg","onTitleBlur","e","newTitle","target","value","title","updateTitle","onDescriptionBlur","newDescription","description","updateDescription","onStoryBlur","newStory","story","updateStory","handleStoryChange","event","addarray","extract","language","remove_digits","return_changed_case","remove_duplicates","word","searchWordExists","included","strength","find","mem","renderCornerControls","editBtn","keywords","cornderCtrls","renderCarouselControls","mfiles","thumbs","mfile","thumburl","goBack","goForward","ubound","length","render","show","memoryContent","carouselControls"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,IAAP,MAAiB,yBAAjB;AACA,OAAOC,GAAP,MAAgB,mBAAhB;AACA,OAAOC,MAAP,MAAmB,sBAAnB;AACA,OAAOC,CAAP,MAAc,wBAAd;AACA,OAAOC,IAAP,MAAiB,oBAAjB;AACA,OAAOC,IAAP,MAAiB,4BAAjB;AACA,OAAOC,KAAP,MAAkB,6BAAlB;AACA,OAAOC,KAAP,MAAkB,qBAAlB;AACA,OAAOC,IAAP,MAAiB,yBAAjB;AACA,OAAOC,WAAP,MAAwB,iCAAxB;AACA,OAAOC,gBAAP,MAA6B,mCAA7B;AACA,OAAO,KAAKC,OAAZ,MAAyB,kBAAzB;AACA,OAAOC,cAAP,MAA2B,mBAA3B;AACA,OAAO,KAAKC,KAAZ,MAAuB,SAAvB;AACA,OAAO,mBAAP;AAEA,SAAQC,iBAAR,EACEC,eADF,EAEEC,eAFF,EAGEC,oBAHF,EAIEC,cAJF,EAKEC,OALF,QAMQ,kBANR;AAOA,SAAQC,QAAR,EAAiBC,MAAjB,EAAwBC,UAAxB,QAAyC,oBAAzC;;AAIA,MAAMC,WAAN,SAA0BxB,KAAK,CAACyB,SAAhC,CAAyC;AAAA;AAAA;AAAA,SAGrCC,KAHqC,GAG9B;AACHC,MAAAA,MAAM,EAAC,IADJ;AAEHC,MAAAA,YAAY,EAAC,EAFV;AAGHC,MAAAA,YAAY,EAAC,EAHV;AAIHC,MAAAA,WAAW,EAAC,EAJT;AAKHC,MAAAA,QAAQ,EAAC,IALN;AAMHC,MAAAA,WAAW,EAAC,EANT;AAOHC,MAAAA,UAAU,EAAC,EAPR;AAQHC,MAAAA,UAAU,EAAC,IARR;AASH/B,MAAAA,MAAM,EAAC,IATJ;AAUHgC,MAAAA,YAAY,EAAC,CAVV;AAWHC,MAAAA,QAAQ,EAAC;AAXN,KAH8B;;AAAA,SAkBvCC,MAlBuC,GAkB9B,MAAK;AACZ,WAAKX,KAAL,CAAWU,QAAX,GAAsB,KAAtB;AACA,WAAKE,KAAL,CAAWC,WAAX,CAAuB,KAAKD,KAAL,CAAWX,MAAlC;AACD,KArBsC;;AAAA,SAwBvCa,kBAxBuC,GAwBlB,CAACC,SAAD,EAAWC,SAAX,KAAwB;AAE3C,UAAG,KAAKJ,KAAL,CAAWX,MAAd,EACA;AACE,YAAG,CAACc,SAAS,CAACd,MAAX,IAAqB,KAAKW,KAAL,CAAWX,MAAX,CAAkBgB,KAAlB,KAA4BF,SAAS,CAACd,MAAV,CAAiBgB,KAArE,EAA2E;AAEzE,eAAKC,mBAAL,CAAyB,KAAKN,KAAL,CAAWP,QAApC;AACAX,UAAAA,OAAO,CAAe,KAAKkB,KAAL,CAAWX,MAAX,CAAkBkB,MAAjC,EAAyC1C,MAAM,IAAI;AACJ,iBAAK2C,QAAL,CAAc;AAAC3C,cAAAA,MAAM,EAACA;AAAR,aAAd;AACA4C,YAAAA,OAAO,CAACC,GAAR,CAAY,cAAcC,IAAI,CAACC,SAAL,CAAe/C,MAAf,CAA1B;AACH,WAH5C,CAAP;AAIAa,UAAAA,eAAe,CAAO,KAAKsB,KAAL,CAAWX,MAAX,CAAkBgB,KAAzB,EAAiCQ,MAAD,IAAU;AAAC,iBAAKL,QAAL,CAAc;AAAClB,cAAAA,YAAY,EAACuB;AAAd,aAAd;AAAqC,WAAhF,CAAf;AACAlC,UAAAA,eAAe,CAAO,KAAKqB,KAAL,CAAWX,MAAX,CAAkBgB,KAAzB,EAAiCS,MAAD,IAAU;AAAC,iBAAKC,iBAAL,CAAuBD,MAAvB;AAA+B,WAA1E,CAAf;AACAlC,UAAAA,oBAAoB,CAAE,KAAKoB,KAAL,CAAWX,MAAX,CAAkBgB,KAApB,EAA4BW,KAAK,IAAG;AAAC,iBAAKC,mBAAL,CAAyBD,KAAzB;AAAgC,WAArE,CAApB;AAID;AACF;AACF,KA3CsC;;AAAA,SA+CvCE,WA/CuC,GA+CzB,MAAM;AAClB,WAAK9B,KAAL,CAAWS,YAAX,GAAwB,CAAxB;AACA,UAAI1B,IAAI,GAAG,KAAKiB,KAAL,CAAWK,QAAX,CAAoB,CAApB,CAAX;AAEA,WAAKL,KAAL,CAAWK,QAAX,CAAoB0B,GAApB,CAAwB,CAACC,OAAD,EAASC,KAAT,KAAkB;AAEtC,YAAGD,OAAO,CAACE,MAAX,EAAkB;AACd,eAAKlC,KAAL,CAAWS,YAAX,GAA0BwB,KAA1B;AACAlD,UAAAA,IAAI,GAAGiD,OAAP;AACH;AACJ,OAND;AAOA,aAAOjD,IAAP;AACD,KA3DsC;;AAAA,SA6DvCmC,mBA7DuC,GA6DhBb,QAAD,IAAc;AAElC,WAAKL,KAAL,CAAWK,QAAX,GAAsBA,QAAtB;AACA,WAAKe,QAAL,CAAc;AACVZ,QAAAA,UAAU,EAAC,KAAKsB,WAAL;AADD,OAAd;AAGD,KAnEsC;;AAAA,SAqEvCD,mBArEuC,GAqEhBD,KAAD,IAAU;AAC9B,WAAKR,QAAL,CAAc;AAAChB,QAAAA,WAAW,EAACwB;AAAb,OAAd;AACD,KAvEsC;;AAAA,SA2EvCD,iBA3EuC,GA2ElBD,MAAD,IAAW;AAC7B,WAAKN,QAAL,CAAc;AAACjB,QAAAA,YAAY,EAACuB;AAAd,OAAd;AACAjC,MAAAA,cAAc,CAAEiC,MAAF,EAAWD,MAAD,IAAU;AAAC,aAAKL,QAAL,CAAc;AAACd,UAAAA,WAAW,EAACmB;AAAb,SAAd;AAAoC,OAAzD,CAAd;AACD,KA9EsC;;AAAA,SAkFvCU,cAlFuC,GAkFvB,MAAK;AACnB,WAAKf,QAAL,CAAc;AAACV,QAAAA,QAAQ,EAAC,CAAC,KAAKV,KAAL,CAAWU;AAAtB,OAAd;AAED,KArFsC;;AAAA,SAyFvC0B,sBAzFuC,GAyFd,MAAK;AAC5B,aAAO,IAAP;AACD,KA3FsC;;AAAA,SA+FvCC,oBA/FuC,GA+FjB,MAAK;AACzBhB,MAAAA,OAAO,CAACC,GAAR,CAAY,wBAAZ;AAED,KAlGsC;;AAAA,SAsGvCgB,YAtGuC,GAsGxB,MAAK;AAClBjB,MAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ;AAED,KAzGsC;;AAAA,SA6GvCiB,gBA7GuC,GA6GrB,MAAK;AACrB,UAAIC,KAAK,GAAG,KAAKxC,KAAL,CAAWQ,UAAvB;;AAEA,UAAGgC,KAAH,EAAS;AACP,YAAGA,KAAK,CAACN,MAAT,EAAgB;AACd,iBAAO,IAAP;AACD,SAFD,MAEK;AACH,iBAAO,KAAP;AACD;AACF,OAND,MAMK;AACH,eAAO,KAAP;AACD;AACF,KAzHsC;;AAAA,SAiJzCO,mBAjJyC,GAiJnB,MAAM;AAE1B,YAAMC,SAAS,GAAK,KAAKC,eAAL,EAApB;AACA,YAAMC,SAAS,GAAK,KAAKC,eAAL,EAApB;AACA,YAAMC,WAAW,GAAG,KAAKC,iBAAL,EAApB;;AAEA,UAAG,KAAK/C,KAAL,CAAWQ,UAAd,EAAyB;AACvB,4BACI;AAAK,UAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAEGkC,SAFH,EAGGE,SAHH,EAIGE,WAJH,CADJ;AASD,OAVD,MAUO;AACL,eAAO,IAAP;AACD;AAEF,KArKwC;;AAAA,SAyKzCE,cAzKyC,GAyKzB,MAAK;AAEnB,UAAG,KAAKhD,KAAL,CAAWU,QAAd,EACA;AACE,4BACE;AAAI,UAAA,SAAS,EAAC,UAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBACE,KAAKV,KAAL,CAAWI,WAAX,CAAuB2B,GAAvB,CAA2B,CAACkB,QAAD,EAAWC,GAAX,KAAmB;AAC9C,8BACE;AAAI,YAAA,SAAS,EAAC,cAAd;AAA6B,YAAA,GAAG,EAAE,MAAIA,GAAtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BACE,oBAAC,QAAD;AAAU,YAAA,UAAU,EAAI3E,IAAxB;AAA8B,YAAA,KAAK,EAAI0E,QAAQ,CAACE,OAAhD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YADF,CADF;AAGU,SAJV,CADF,CADF;AASD,OAXD,MAWK;AACH,4BACE;AAAI,UAAA,SAAS,EAAC,UAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBACE,KAAKnD,KAAL,CAAWI,WAAX,CAAuB2B,GAAvB,CAA2B,CAACkB,QAAD,EAAWC,GAAX,KAAmB;AAC9C,8BACE;AAAI,YAAA,SAAS,EAAC,cAAd;AAA6B,YAAA,GAAG,EAAE,MAAIA,GAAtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BACE,oBAAC,QAAD;AAAU,YAAA,UAAU,EAAI3E,IAAxB;AAA8B,YAAA,KAAK,EAAI0E,QAAQ,CAACE,OAAhD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YADF,CADF;AAGU,SAJV,CADF,CADF;AASD;AACF,KAjMwC;;AAAA,SAqMzCC,kBArMyC,GAqMrB,MAAK;AACvB,YAAM3B,MAAM,GAAI,KAAKzB,KAAL,CAAWE,YAAX,CAAwB6B,GAAxB,CACdsB,CAAC,IAAI;AACD,4BACE;AACE,UAAA,SAAS,EAAC,cADZ;AAEE,UAAA,GAAG,EAAE,MAAMA,CAAC,CAAClC,MAFf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAEuB,oBAAC,UAAD;AAAY,UAAA,GAAG,EAAI3C,GAAnB;AAAwB,UAAA,KAAK,EAAI6E,CAAC,CAACC,SAAF,GAAY,GAAZ,GAAgBD,CAAC,CAACE,QAAnD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAFvB,CADF;AAMD,OARW,CAAhB;;AASI,UAAG,KAAKvD,KAAL,CAAWvB,MAAd,EAAqB;AACnBgD,QAAAA,MAAM,CAAC+B,IAAP,eACE;AAAI,UAAA,GAAG,EAAE,MAAM,KAAKxD,KAAL,CAAWvB,MAAX,CAAkB0C,MAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBACE,oBAAC,UAAD;AACE,UAAA,GAAG,EAAI1C,MADT;AAEE,UAAA,KAAK,EAAI,KAAKuB,KAAL,CAAWvB,MAAX,CAAkB6E,SAAlB,GAA8B,GAA9B,GAAoC,KAAKtD,KAAL,CAAWvB,MAAX,CAAkB8E,QAFjE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADF,CADF;AAOD;;AACD9B,MAAAA,MAAM,CAACgC,OAAP;AACJ,aAAOhC,MAAP;AACD,KA1NwC;;AAAA,SA8NzCiC,aA9NyC,GA8N1B,MAAM;AACnB,YAAMC,OAAO,gBACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AACE,QAAA,SAAS,EAAC,cADZ;AAEE,QAAA,GAAG,EAAE,UAFP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAEmB,oBAAC,UAAD;AAAY,QAAA,GAAG,EAAInF,GAAnB;AAAwB,QAAA,KAAK,EAAI,KAAKoC,KAAL,CAAWX,MAAX,CAAkB2D,QAAnD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFnB,CADF,eAKE;AACE,QAAA,SAAS,EAAC,cADZ;AAEE,QAAA,GAAG,EAAE,KAFP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAEc,oBAAC,UAAD;AAAY,QAAA,GAAG,EAAIpF,GAAnB;AAAwB,QAAA,KAAK,EAAI,KAAKoC,KAAL,CAAWX,MAAX,CAAkB4D,SAAnD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFd,CALF,CADF;AAWA,aAAOF,OAAP;AACD,KA3OwC;;AAAA,SA+OzChB,eA/OyC,GA+OxB,MAAI;AACnB,UAAImB,YAAY,GAAC,IAAjB;;AAEA,UAAG,KAAK9D,KAAL,CAAWU,QAAd,EAAuB;AACrB,YAAIqD,OAAO,GAAG,KAAKxB,gBAAL,KAA0BxD,IAA1B,GAAiCC,WAA/C;AAEA8E,QAAAA,YAAY,gBACZ;AAAK,UAAA,SAAS,EAAG,kBAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBACE;AACE,UAAA,SAAS,EAAC,UADZ;AAEE,UAAA,GAAG,EAAIhF,KAFT;AAGE,UAAA,OAAO,EAAE,KAAKuD,oBAHhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADF,eAME;AACE,UAAA,SAAS,EAAC,UADZ;AAEE,UAAA,GAAG,EAAI0B,OAFT;AAGE,UAAA,OAAO,EAAI,KAAKzB,YAHlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UANF,CADA;AAaD;;AAED,0BACE;AAAK,QAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE,oBAAC,gBAAD;AACE,QAAA,OAAO,EAAE,KAAKtC,KAAL,CAAWQ,UADtB;AAEE,QAAA,eAAe,EAAE,kBAFnB;AAGE,QAAA,cAAc,EAAE,kBAHlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,EAMGsD,YANH,CADF;AAUD,KA9QwC;;AAAA,SAgRzCE,WAhRyC,GAgR1BC,CAAD,IAAO;AACnB,YAAMC,QAAQ,GAAGD,CAAC,CAACE,MAAF,CAASC,KAA1B;;AACA,UAAGF,QAAQ,KAAK,KAAKtD,KAAL,CAAWX,MAAX,CAAkBoE,KAAlC,EAAwC;AACtCnF,QAAAA,OAAO,CAACoF,WAAR,CAAoB,KAAK1D,KAAL,CAAWX,MAAX,CAAkBgB,KAAtC,EAA4CiD,QAA5C;AACD;AACF,KArRwC;;AAAA,SAwRzCK,iBAxRyC,GAwRpBN,CAAD,IAAO;AACzB,YAAMO,cAAc,GAAGP,CAAC,CAACE,MAAF,CAASC,KAAhC;;AACA,UAAGI,cAAc,KAAK,KAAK5D,KAAL,CAAWX,MAAX,CAAkBwE,WAAxC,EAAoD;AAClDvF,QAAAA,OAAO,CAACwF,iBAAR,CAA0B,KAAK9D,KAAL,CAAWX,MAAX,CAAkBgB,KAA5C,EAAkDuD,cAAlD;AACD;AACF,KA7RwC;;AAAA,SAgSzCG,WAhSyC,GAgS1BV,CAAD,IAAO;AACnB,YAAMW,QAAQ,GAAGX,CAAC,CAACE,MAAF,CAASC,KAA1B;;AACA,UAAGQ,QAAQ,KAAK,KAAKhE,KAAL,CAAWX,MAAX,CAAkB4E,KAAlC,EAAwC;AACtC3F,QAAAA,OAAO,CAAC4F,WAAR,CAAoB,KAAKlE,KAAL,CAAWX,MAAX,CAAkBgB,KAAtC,EAA4C2D,QAA5C;AACD;AACF,KArSwC;;AAAA,SAySzCG,iBAzSyC,GAySpBC,KAAD,IAAU;AAC5B,UAAIC,QAAQ,GAAG,KAAKjF,KAAL,CAAWI,WAA1B;AACA,UAAIyE,KAAK,GAAGG,KAAK,CAACb,MAAN,CAAaC,KAAzB;AACA,UAAIxC,KAAK,GAAGzC,cAAc,CAAC+F,OAAf,CAAuBL,KAAvB,EACwB;AACIM,QAAAA,QAAQ,EAAC,SADb;AAEIC,QAAAA,aAAa,EAAE,IAFnB;AAGIC,QAAAA,mBAAmB,EAAC,IAHxB;AAIIC,QAAAA,iBAAiB,EAAE;AAJvB,OADxB,CAAZ;AAOA1D,MAAAA,KAAK,CAACG,GAAN,CAAUwD,IAAI,IAAG;AACb,YAAG,CAAC,KAAKC,gBAAL,CAAsBD,IAAtB,CAAJ,EAAgC;AAC9BN,UAAAA,QAAQ,CAACzB,IAAT,CAAc;AAACiC,YAAAA,QAAQ,EAAC,IAAV;AAAetC,YAAAA,OAAO,EAACoC,IAAvB;AAA4BG,YAAAA,QAAQ,EAAC;AAArC,WAAd;AACArE,UAAAA,OAAO,CAACC,GAAR,CAAY,eAAeiE,IAA3B;AAED;AACJ,OAND;AAOA,WAAKnE,QAAL,CAAc;AAAChB,QAAAA,WAAW,EAAC6E,QAAb;AAAsBJ,QAAAA,KAAK,EAACA;AAA5B,OAAd;AACD,KA3TwC;;AAAA,SA+TzCW,gBA/TyC,GA+TrBD,IAAD,IAAU;AAC3B,aAAO,KAAKvF,KAAL,CAAWI,WAAX,CAAuBuF,IAAvB,CAA4B1C,QAAQ,IAAIsC,IAAI,KAAKtC,QAAQ,CAACE,OAA1D,CAAP;AACD,KAjUwC;;AAAA,SAqUzCN,eArUyC,GAqUvB,MAAK;AACrB,YAAM+C,GAAG,GAAG,KAAKhF,KAAL,CAAWX,MAAvB;;AACA,UAAG,KAAKD,KAAL,CAAWU,QAAd,EACA;AACE,4BACE;AAAK,UAAA,SAAS,EAAG,YAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBACE;AACI,UAAA,MAAM,EAAI,KAAKsD,WADnB;AACgC,UAAA,SAAS,EAAC,uBAD1C;AAEI,UAAA,IAAI,EAAC,MAFT;AAEiB,UAAA,YAAY,EAAI4B,GAAG,CAACvB,KAFrC;AAE4C,UAAA,WAAW,EAAC,OAFxD;AAEgE,UAAA,EAAE,EAAC,OAFnE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADF,eAIE;AACI,UAAA,MAAM,EAAI,KAAKE,iBADnB;AACsC,UAAA,SAAS,EAAC,6BADhD;AAEI,UAAA,IAAI,EAAC,MAFT;AAEiB,UAAA,YAAY,EAAIqB,GAAG,CAACnB,WAFrC;AAEkD,UAAA,WAAW,EAAC,aAF9D;AAE4E,UAAA,EAAE,EAAC,aAF/E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAJF,eAOE;AACI,UAAA,MAAM,EAAM,KAAKE,WADrB;AACkC,UAAA,SAAS,EAAC,uBAD5C;AACoE,UAAA,QAAQ,EAAI,KAAKI,iBADrF;AAEI,UAAA,IAAI,EAAC,MAFT;AAEiB,UAAA,YAAY,EAAIa,GAAG,CAACf,KAFrC;AAE4C,UAAA,WAAW,EAAC,aAFxD;AAEsE,UAAA,EAAE,EAAC,aAFzE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAPF,CADF;AAaD,OAfD,MAeK;AACH,4BACE;AAAK,UAAA,SAAS,EAAG,YAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAKe,GAAG,CAACvB,KAAT,MADF,eAEE;AAAG,UAAA,SAAS,EAAC,mCAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAkDuB,GAAG,CAACnB,WAAtD,CAFF,eAGE;AAAG,UAAA,SAAS,EAAC,8BAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAA+CmB,GAAG,CAACf,KAAnD,MAHF,CADF;AAOD;AAEF,KAhWwC;;AAAA,SAoWzCgB,oBApWyC,GAoWnB,MAAK;AACzB,UAAIC,OAAO,GAAG,IAAd;;AACA,UAAG,KAAK1D,sBAAL,EAAH,EAAiC;AAC/B0D,QAAAA,OAAO,gBACL;AACA,UAAA,SAAS,EAAC,UADV;AAEA,UAAA,GAAG,EAAInH,IAFP;AAGA,UAAA,OAAO,EAAE,KAAKwD,cAHd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADF;AAKD;;AACD,0BACE;AAAK,QAAA,SAAS,EAAC,QAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AACE,QAAA,SAAS,EAAC,UADZ;AAEE,QAAA,GAAG,EAAIzD,CAFT;AAGE,QAAA,OAAO,EAAE,KAAKiC,MAHhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,EAKKmF,OALL,CADF;AAWD,KAxXwC;;AAAA,SA4XzC/C,iBA5XyC,GA4XrB,MAAM;AACxB,YAAMgD,QAAQ,GAAO,KAAK/C,cAAL,EAArB;AACA,YAAMvB,MAAM,GAAS,KAAK2B,kBAAL,EAArB;AACA,YAAMO,OAAO,GAAQ,KAAKD,aAAL,EAArB;AACA,YAAMsC,YAAY,GAAG,KAAKH,oBAAL,EAArB;AAEA,0BACE;AAAK,QAAA,SAAS,EAAG,eAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBADF,EAEGE,QAFH,eAGE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAHF,eAIE;AAAI,QAAA,SAAS,EAAC,UAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAA6BtE,MAA7B,MAJF,eAKE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBALF,eAME;AAAI,QAAA,SAAS,EAAC,UAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAA6BkC,OAA7B,MANF,EAOGqC,YAPH,CADF;AAWD,KA7YwC;;AAAA,SAgZzCC,sBAhZyC,GAgZhB,MAAM;AAC7B,UAAG,KAAKjG,KAAL,CAAWK,QAAd,EACA;AACE,cAAMuF,GAAG,GAAG,KAAKhF,KAAL,CAAWX,MAAvB;AACA,cAAMiG,MAAM,GAAG,KAAKlG,KAAL,CAAWK,QAA1B;AACA,cAAM8F,MAAM,GAAGD,MAAM,CAACnE,GAAP,CAAW,CAACqE,KAAD,EAAOnE,KAAP,KAAgB;AACtC,8BACE;AAAK,YAAA,GAAG,EAAE,UAAQA,KAAlB;AAAyB,YAAA,SAAS,EAAC,OAAnC;AAA2C,YAAA,GAAG,EAAImE,KAAK,CAACC,QAAxD;AAAkE,YAAA,OAAO,EAAGpE,KAAD,IAAU,CAAE,CAAvF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YADF;AAEE,SAHS,CAAf;AAKA,4BACE;AAAK,UAAA,SAAS,EAAC,YAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBACE;AAAK,UAAA,SAAS,EAAC,UAAf;AAA0B,UAAA,GAAG,EAAIrD,IAAjC;AAAuC,UAAA,OAAO,EAAE,KAAK0H,MAArD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADF,eAEE;AAAK,UAAA,SAAS,EAAC,YAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACKH,MADL,CAFF,eAKE;AAAK,UAAA,SAAS,EAAC,UAAf;AAA0B,UAAA,GAAG,EAAItH,KAAjC;AAAwC,UAAA,OAAO,EAAE,KAAK0H,SAAtD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UALF,CADF;AASD,OAlBD,MAkBK;AACH,eAAO,IAAP;AACD;AACF,KAtawC;;AAAA,SA0azCD,MA1ayC,GA0a/BrC,CAAD,IAAO;AACd,UAAG,KAAKjE,KAAL,CAAWK,QAAd,EACA;AACE,YAAImG,MAAM,GAAG,KAAKxG,KAAL,CAAWK,QAAX,CAAoBoG,MAApB,GAA2B,CAAxC;;AACA,YAAG,KAAKzG,KAAL,CAAWS,YAAX,KAA4B,CAA/B,EAAiC;AAC/B,eAAKT,KAAL,CAAWS,YAAX,GAA0B+F,MAA1B;AACD,SAFD,MAEK;AACH,eAAKxG,KAAL,CAAWS,YAAX;AACD;;AACD,aAAKW,QAAL,CAAc;AAACZ,UAAAA,UAAU,EAAC,KAAKR,KAAL,CAAWK,QAAX,CAAoB,KAAKL,KAAL,CAAWS,YAA/B;AAAZ,SAAd;AACD;AACF,KArbwC;;AAAA,SAubzC8F,SAvbyC,GAub5BtC,CAAD,IAAO;AACjB,UAAG,KAAKjE,KAAL,CAAWK,QAAd,EACA;AACE,YAAImG,MAAM,GAAG,KAAKxG,KAAL,CAAWK,QAAX,CAAoBoG,MAApB,GAA2B,CAAxC;;AACA,YAAG,KAAKzG,KAAL,CAAWS,YAAX,KAA4B+F,MAA/B,EAAsC;AACpC,eAAKxG,KAAL,CAAWS,YAAX,GAA0B,CAA1B;AACD,SAFD,MAEK;AACH,eAAKT,KAAL,CAAWS,YAAX;AACD;;AACD,aAAKW,QAAL,CAAc;AAACZ,UAAAA,UAAU,EAAC,KAAKR,KAAL,CAAWK,QAAX,CAAoB,KAAKL,KAAL,CAAWS,YAA/B;AAAZ,SAAd;AACD;AACF,KAlcwC;AAAA;;AA2HvC;AAEAiG,EAAAA,MAAM,GAAE;AAEN,QAAG,KAAK9F,KAAL,CAAW+F,IAAd,EAAmB;AACjB,UAAIC,aAAa,GAAG,KAAKnE,mBAAL,EAApB;AACA,UAAIoE,gBAAgB,GAAG,KAAKZ,sBAAL,EAAvB;AACA,0BACE;AAAK,QAAA,SAAS,EAAE,eAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACE;AAAK,QAAA,SAAS,EAAC,YAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACGW,aADH,EAEGC,gBAFH,CADF,CADF;AAQD,KAXD,MAWK;AACH,aAAO,IAAP;AACD;AACJ,GA7IwC,CA+IzC;;;AA/IyC;;AAscxC;AAGD,eAAe/G,WAAf","sourcesContent":["import React from 'react';\nimport tick from '../images/checkmark.png'\nimport tag from '../images/tag.png'\nimport author from '../images/author.png'\nimport x from '../images/x-symbol.png'\nimport edit from '../images/edit.png'\nimport left from '../images/chevron-left.png'\nimport right from '../images/chevron-right.png'\nimport trash from '../images/trash.png'\nimport hero from '../images/hero-full.png'\nimport heroOutline from '../images/hero-outline-grey.png'\nimport MemoryFileViewer from '../memoryviewer/memoryImageViewer'\nimport * as Memriio from '../memriioserver'\nimport WordExctractor from 'keyword-extractor'\nimport * as Utils from './utils'\nimport './memorymodal.css'\n\nimport {getAllMemoryFiles, \n  getTaggedPeople,\n  getMemoryClouds,\n  getMemorySearchWords, \n  getCloudPeople,\n  getUser,\n } from '../memriioserver'\nimport {CheckBox,SubTag,ImageLabel} from '../buttons/buttons'\n\n\n\nclass MemoryModal extends React.Component{\n\n    \n    state ={\n        memory:null,\n        taggedPeople:[],\n        memoryClouds:[],\n        searchWords:[],         \n        memfiles:null,\n        cloudPeople:[],\n        userClouds:[],\n        activefile:null,\n        author:null,\n        memfileIndex:0,\n        editMode:false,\n    }\n   \n\n  onHide = () =>{\n    this.state.editMode = false\n    this.props.onHideModal(this.props.memory)\n  }\n//---------------------------------------------------------------------------------\n\n  componentDidUpdate = (prevProps,prevState) =>{\n    \n    if(this.props.memory)\n    {\n      if(!prevProps.memory || this.props.memory.memid !== prevProps.memory.memid){\n        \n        this.populateMemoryFiles(this.props.memfiles)\n        getUser              (this.props.memory.userid,(author => {\n                                                              this.setState({author:author})\n                                                              console.log('Author + ' + JSON.stringify(author))\n                                                          }))\n        getTaggedPeople      (this.props.memory.memid,((people)=>{this.setState({taggedPeople:people})}))\n        getMemoryClouds      (this.props.memory.memid,((clouds)=>{this.populateCloudInfo(clouds)}))\n        getMemorySearchWords (this.props.memory.memid,((words =>{this.populateSearchWords(words)})))\n        \n        \n        \n      }      \n    }\n  }\n\n//---------------------------------------------------------------------------------\n\n  getHeroFile = () => {\n    this.state.memfileIndex=0\n    let hero = this.state.memfiles[0]\n\n    this.state.memfiles.map((memfile,index)=> {\n\n        if(memfile.ishero){         \n            this.state.memfileIndex = index            \n            hero = memfile\n        }\n    })\n    return hero\n  }\n//---------------------------------------------------------------------------------\n  populateMemoryFiles = (memfiles) => {\n\n    this.state.memfiles = memfiles\n    this.setState({\n        activefile:this.getHeroFile()\n    })\n  }\n//---------------------------------------------------------------------------------\n  populateSearchWords = (words) =>{\n    this.setState({searchWords:words})\n  }\n\n//------------------------------------------------------------------------\n\n  populateCloudInfo = (clouds) =>{\n    this.setState({memoryClouds:clouds})\n    getCloudPeople (clouds,((people)=>{this.setState({cloudPeople:people})}))   \n  }\n\n//------------------------------------------------------------------------\n\n  toggleEditMode =() =>{\n    this.setState({editMode:!this.state.editMode})\n    \n  }\n\n  //------------------------------------------------------------------------\n\n  userIsAuthorisedToEdit = () =>{\n    return true\n  }\n\n  //------------------------------------------------------------------------\n\n  deleteFileFromMemory =() =>{\n    console.log('delte file from memroy');\n    \n  }\n  \n  //------------------------------------------------------------------------\n\n  makeHeroFile = () =>{\n    console.log('make hero file');\n    \n  }\n  \n  //------------------------------------------------------------------------\n\n  activeFileisHero =() =>{\n    var afile = this.state.activefile\n    \n    if(afile){\n      if(afile.ishero){\n        return true\n      }else{\n        return false\n      }\n    }else{\n      return false\n    }\n  }\n  \n  //------------------------------------------------------------------------\n\n  render(){\n      \n    if(this.props.show){\n      let memoryContent = this.renderMemoryContent()\n      let carouselControls = this.renderCarouselControls()\n      return(\n        <div className= 'backdropStyle'>\n          <div className='modalStyle'>\n            {memoryContent}              \n            {carouselControls}\n          </div>\n        </div>\n      )\n    }else{\n      return null\n    }        \n}\n\n//------------------------------------------------------------------------\n\nrenderMemoryContent = () => {\n    \n  const imageZone   = this.renderImageZone()\n  const storyZone   = this.renderStoryZone()\n  const detailsZone = this.renderDetailsZone()\n\n  if(this.state.activefile){\n    return (\n        <div className='modalrow'>\n          \n          {imageZone}\n          {storyZone}\n          {detailsZone}\n\n        </div>\n    )\n  } else {\n    return null\n  }\n  \n}\n\n//------------------------------------------------------------------------\n\nrenderKeyWords =() =>{\n \n  if(this.state.editMode)\n  {\n    return (\n      <ul className='wordList' > {\n        this.state.searchWords.map((wordItem, idx) => {\n        return (\n          <li className='wordListItem' key={'k'+idx}>\n            <CheckBox checkedImg = {tick} label = {wordItem.keyword}/>\n          </li> )})}\n      </ul>\n    )\n  }else{\n    return (\n      <ul className='wordList' > {\n        this.state.searchWords.map((wordItem, idx) => {\n        return (\n          <li className='wordListItem' key={'k'+idx}>\n            <CheckBox checkedImg = {tick} label = {wordItem.keyword}/>\n          </li> )})}\n      </ul>\n    )\n  }\n}\n\n//------------------------------------------------------------------------\n\nrenderTaggedPeople =() =>{\n  const people  = this.state.taggedPeople.map(\n    p => {\n        return (\n          <li \n            className='wordListItem'\n            key={'t' + p.userid}><ImageLabel img = {tag} label = {p.firstname+' '+p.lastname}/>                                                        \n          </li>\n        )\n      })\n      if(this.state.author){\n        people.push(      \n          <li key={'a' + this.state.author.userid}>\n            <ImageLabel \n              img = {author}\n              label = {this.state.author.firstname + ' ' + this.state.author.lastname}/>\n          </li>\n        ) \n      }\n      people.reverse()   \n  return people\n}\n\n//------------------------------------------------------------------------\n\nrenderDetails =() => {\n  const details = \n    <div>\n      <li \n        className='wordListItem'\n        key={'location'}><ImageLabel img = {tag} label = {this.props.memory.location}/>\n      </li>\n      <li \n        className='wordListItem'\n        key={'sss'}><ImageLabel img = {tag} label = {this.props.memory.createdon}/>\n      </li>\n    </div>\n  return details\n}\n\n//------------------------------------------------------------------------\n\nrenderImageZone =()=>{\n  let editControls=null\n\n  if(this.state.editMode){\n    var heroImg = this.activeFileisHero() ? hero : heroOutline;\n\n    editControls = \n    <div className = 'imageEditConrols' >\n      <img  \n        className='closeBtn'\n        src = {trash}\n        onClick={this.deleteFileFromMemory} \n        />\n      <img  \n        className='closeBtn'\n        src = {heroImg}\n        onClick = {this.makeHeroFile}\n       />\n    </div>\n  }\n\n  return (\n    <div className='imgcolumn'>\n      <MemoryFileViewer \n        memfile={this.state.activefile}\n        thumbStyleClass={'memoryModalImage'}\n        fileStyleClass={'memoryModalImage'}\n      />\n      {editControls}\n    </div>\n  )\n}\n\nonTitleBlur = (e) => {\n  const newTitle = e.target.value\n  if(newTitle !== this.props.memory.title){\n    Memriio.updateTitle(this.props.memory.memid,newTitle)\n  }  \n}\n//------------------------------------------------------------------------\n\nonDescriptionBlur = (e) => {\n  const newDescription = e.target.value\n  if(newDescription !== this.props.memory.description){\n    Memriio.updateDescription(this.props.memory.memid,newDescription)\n  }  \n}\n//------------------------------------------------------------------------\n\nonStoryBlur = (e) => {\n  const newStory = e.target.value\n  if(newStory !== this.props.memory.story){\n    Memriio.updateStory(this.props.memory.memid,newStory)\n  }  \n}\n\n//------------------------------------------------------------------------\n\nhandleStoryChange = (event) =>{\n  let addarray = this.state.searchWords\n  let story = event.target.value\n  let words = WordExctractor.extract(story,\n                                      {\n                                          language:\"english\",\n                                          remove_digits: true,\n                                          return_changed_case:true,\n                                          remove_duplicates: true\n                                      });\n  words.map(word =>{\n      if(!this.searchWordExists(word)){\n        addarray.push({included:true,keyword:word,strength:0})\n        console.log('word added' + word);\n        \n      }      \n  }) \n  this.setState({searchWords:addarray,story:story})  \n}\n\n//------------------------------------------------------------------------\n\nsearchWordExists = (word) => {\n  return this.state.searchWords.find(wordItem => word === wordItem.keyword)    \n}\n\n//------------------------------------------------------------------------\n\nrenderStoryZone = () =>{\n  const mem = this.props.memory\n  if(this.state.editMode)\n  {\n    return (\n      <div className = 'infoColumn'>\n        <input \n            onBlur = {this.onTitleBlur} className='input-reset titleEdit' \n            type=\"text\"  defaultValue = {mem.title} placeholder='Title' id=\"title\" />\n        <input \n            onBlur = {this.onDescriptionBlur} className='input-reset descriptionEdit' \n            type=\"text\"  defaultValue = {mem.description} placeholder='Description' id=\"description\" />\n        <textarea\n            onBlur   = {this.onStoryBlur} className='input-reset storyEdit' onChange = {this.handleStoryChange} \n            type=\"text\"  defaultValue = {mem.story} placeholder='Description' id=\"description\" /> \n      </div>  \n    )\n  }else{\n    return (\n      <div className = 'infoColumn'>\n        <h4>{mem.title} </h4>\n        <p className=\"f6 lh-copy i measure mt2 mid-gray\">{mem.description}</p>\n        <p className=\"f6 lh-copy measure mt2 black\"> { mem.story } </p>\n      </div>  \n    )\n  }\n  \n}\n\n//------------------------------------------------------------------------\n\nrenderCornerControls =() =>{\n  let editBtn = null\n  if(this.userIsAuthorisedToEdit()){\n    editBtn=\n      <img  \n      className='closeBtn'                   \n      src = {edit}\n      onClick={this.toggleEditMode} />\n  }\n  return (\n    <div className='footer'>                        \n      <img  \n        className='closeBtn'                   \n        src = {x}\n        onClick={this.onHide} />\n        {editBtn}\n\n    </div>\n\n  )\n}\n\n//------------------------------------------------------------------------\n\nrenderDetailsZone = () => {\n  const keywords     = this.renderKeyWords()\n  const people       = this.renderTaggedPeople()\n  const details      = this.renderDetails()\n  const cornderCtrls = this.renderCornerControls()\n\n  return (\n    <div className = 'detailsColumn'>\n      <h4>Tags </h4>\n      {keywords}\n      <h4>People</h4>\n      <ul className='wordList' > { people   } </ul>\n      <h4>Details</h4>\n      <ul className='wordList' > { details   } </ul>\n      {cornderCtrls}              \n    </div>  \n  )\n}\n//------------------------------------------------------------------------\n\nrenderCarouselControls = () => {\n  if(this.state.memfiles)\n  {\n    const mem = this.props.memory\n    const mfiles = this.state.memfiles\n    const thumbs = mfiles.map((mfile,index) =>{\n        return(\n          <img key={'thumb'+index} className='thumb' src = {mfile.thumburl} onClick={(index) =>{}}/> \n        )})\n    \n    return (\n      <div className='controlbox'>\n        <img className='closeBtn' src = {left} onClick={this.goBack} /> \n        <div className='thumbArray'>\n            {thumbs}\n        </div> \n        <img className='closeBtn' src = {right} onClick={this.goForward} /> \n      </div>\n    )\n  }else{\n    return null\n  }\n}\n\n//------------------------------------------------------------------------\n\ngoBack = (e) => {\n  if(this.state.memfiles)\n  {\n    let ubound = this.state.memfiles.length-1\n    if(this.state.memfileIndex === 0){\n      this.state.memfileIndex = ubound \n    }else{\n      this.state.memfileIndex--\n    }\n    this.setState({activefile:this.state.memfiles[this.state.memfileIndex]})\n  }\n}\n\ngoForward = (e) => {\n  if(this.state.memfiles)\n  {\n    let ubound = this.state.memfiles.length-1\n    if(this.state.memfileIndex === ubound){\n      this.state.memfileIndex = 0 \n    }else{\n      this.state.memfileIndex++\n    }\n    this.setState({activefile:this.state.memfiles[this.state.memfileIndex]})\n  }    \n}\n\n  \n\n};  \n\n\nexport default MemoryModal;\n\n\n"]},"metadata":{},"sourceType":"module"}